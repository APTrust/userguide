{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to APTrust","text":"<p>The Academic Preservation Trust (APTrust) is a distributed digital preservation repository committed to preserving the digital heritage of its depositors. APTrust services are open to sustaining members (who pay an annual fee directly to us) and to sub-accounts created by sustaining members.</p>"},{"location":"#before-you-get-started","title":"Before You Get Started","text":"<p>Assuming you are already either a sustaining member, or have been added as a sub-account by a sustaining member, the process for getting started looks like this:</p> <p>You send the following information to help@aptrust.org:</p> <ul> <li> <p>The name, email address, and phone number of a person at your organization who will act as your APTrust administrator. We prefer that you send a mobile number so you can use two-factor authentication.</p> </li> <li> <p>Your institution's domain name. (For example, virginia.edu.)</p> </li> </ul> <p>We'll reply to your email with the following:</p> <ul> <li> <p>Information on how to log in to your Registry account. Registry is our online registry, showing what you have deposited with APTrust and exposing the features you'll need to restore, delete, query, and audit your materials.</p> </li> <li> <p>A set of AWS credentials that you'll use to upload matierials to our system.</p> </li> </ul>"},{"location":"#first-steps","title":"First Steps","text":"<p>Once your local administrator has access to Registry, they can add new users and/or adminstrators for your institution. Registry users have access to all features except:</p> <ul> <li>Adding and deactivating user accounts.</li> <li>Approving requests to delete materials from the repository.</li> </ul> <p>Registry administrators can do both of the above.</p> <p>If you're new to APTrust, you will likely start out by using our demo system to fine-tune your ingest workflows. Once you are able to push materials successfully into the demo repository, you can begin using the production system.</p>"},{"location":"contact_us/","title":"Contact APTrust","text":"<p>For technical problems and help with your account, contact help@aptrust.org.</p> <p>To keep up with what's going on, join the APTrust community mailing list or drop in to one of our Slack channels:</p> <ul> <li>aptrust_community contains general information for all members</li> <li>bagging provides community support for bagging issues</li> </ul> <p>Want to report a bug or request a new feature? Open a Trello ticket, or write us at help@aptrust.org.</p>"},{"location":"glossary/","title":"Core Concepts","text":"<p>Before proceeding with this documentation, we'd like to clarify a few core concepts and essential terms.</p>"},{"location":"glossary/#generic-file","title":"Generic File","text":"<p>A single file or bitstream that makes up part of an intellectual object. For example, in a collection of jpeg photos that includes an XML metadata file, each jpeg and the XML file is a generic file.</p>"},{"location":"glossary/#intellectual-object","title":"Intellectual Object","text":"<p>A collection of generic files logically grouped into a single unit. An intellectual object typically consists of the payload files and tag files submitted in a bag.</p>"},{"location":"glossary/#registry","title":"Registry","text":"<p>Registry is the searchable online registry that keeps track of everything you've deposited in APTrust. It includes a web UI and a REST API that enable you to do the following:</p> <ul> <li>See what items you've deposited</li> <li>Search for items by object name, file name, and a number of other attributes</li> <li>View audit data (PREMIS events) for items you've deposited</li> <li>Request that objects and/or files be restored</li> <li>Request that objects and/or files be deleted (Does the REST API support this?)</li> <li>Query the status of ingest and restoration requests in progress</li> <li>Add and remove user accounts for your institution</li> </ul> <p>Registry includes both a demo and production system. The demo system is for depositors to test new workflows and to get familiar with the system's general features. The production system is for long-term preservation.</p> <p>Registry Demo URL: https://demo.aptrust.org</p> <p>Registry Production URL: https://repo.aptrust.org</p> <p>API Keys and Separate Systems</p> <p>Once you have a valid Registry login, you can generate your own API key to use the REST API. [Link when available...] Keep in mind that while your login email may be the same for both the demo and production Registry systems, your API keys will be different.</p>"},{"location":"glossary/#receiving-bucket","title":"Receiving Bucket","text":"<p>APTrust provides two receiving buckets for each depositor: one for the demo environment and one for the production environment. A receiving bucket is an Amazon AWS S3 bucket to which you upload materials for ingest into APTrust. Upload bags to your demo receiving bucket to ingest them into the demo system, and to the production bucket to ingest them into the production system.</p> <p>Receiving bucket names follow this pattern:</p> <p>Demo System: aptrust.receiving.test.&lt;your-domain.xyx&gt;</p> <p>Production System: aptrust.receiving.&lt;your-domain.xyz&gt;</p> <p>For example, if your domain name is example.org, your receiving buckets will be aptrust.receiving.test.example.or for demo and aptrust.receiving.example.org for production.</p>"},{"location":"glossary/#restoration-bucket","title":"Restoration Bucket","text":"<p>When you ask for APTrust to restore an object, our system reassembles all of the object's files into a BagIt bag and copies it to your receiving bucket. (Individual files can be restored the same way, though they are not bagged.) The restoration process may take anywhere from a few seconds to several hours, depending on the amount of data restored and where it is stored. Once the restoration is complete, you can download the restore object or files from your restoration bucket.</p> <p>You Need AWS Access Keys to Use Your Buckets!</p> <p>You will need to get AWS credentials from APTrust to access your receiving and restoration buckets. APTrust sends them as part of the onboarding process when you first set up your account. If you need credentials, contact help@aptrust.org.</p>"},{"location":"glossary/#dart","title":"DART","text":"<p>DART is the Digital Archivist's Resource Tool. The initial release of DART 2.0 provides a drag-and-drop interface for bagging files and sending them to APTrust. DART is the easiest way to complete your first APTrust Deposit.</p> <p>To get started with DART, visit https://aptrust.github.io/dart-docs/users/getting_started/.</p>"},{"location":"old_partner_tools/","title":"Partner Tools","text":"<p>Warning</p> <p>This page describes the old version 2 partner tools, which are now deprecated. Please see the docs for the new, version 3 partner tools, which add support for creating bags and interacting with the APTrust Registry.</p> <p>Deprecated version 2 command line tools for Mac, Linux, and Windows are available through the links below:</p> <ul> <li> <p>OSX Intel 64-bit, v 2.2-beta</p> </li> <li> <p>OSX M1 &amp; M2, v2.2-beta</p> </li> <li> <p>Linux 64-bit, v 2.2-beta</p> </li> <li> <p>Windows 64-bit, v 2.2-beta</p> </li> </ul> <p>Each of these tools returns specific exit codes, so you can integrate them into your scripts. You can view any program's built-in documentation by passing the --help flag.</p>"},{"location":"old_partner_tools/#list-of-partner-tools","title":"List of Partner Tools","text":"<p>In addition to our graphical tool for bagging and uploading, DART, APTrust also distributes a suite of command-line tools.</p> <p>These tools use less memory and generally less CPU than DART. They include:</p> Tool Description apt_check_ingest Queries Pharos to check the ingest status of a bag. This requires a Pharos API key. See the configuration section below. apt_validate Validates bags (tarred or untarred) before uploading them for ingest or after downloading them from the restoration bucket. apt_upload Uploads bags to your receiving buckets for ingest. Requires AWS keys be present in your config file. See below. apt_list Lists the contents of your receiving and restoration buckets. Requires AWS keys. apt_download Downloads restored bags from your restoration buckets. Requires AWS keys. apt_delete Deletes restored bags from your restoration buckets. Requires AWS keys. <p>Note that each of these tools has a <code>--help</code> option to display available flags, output formats, and return codes.</p>"},{"location":"old_partner_tools/#configuration-file","title":"Configuration File","text":"<p>All of the tools except apt_validate require a simple config file with five name-value pairs. Note that quotes are optional, and comment lines begin with a hash mark.</p> <pre><code># Config for apt_upload and apt_download\nAwsAccessKeyId = 123456789XYZ\nAwsSecretAccessKey = THIS KEY INCLUDES SPACES AND DOES NOT NEED QUOTES\nReceivingBucket = 'aptrust.receiving.universityname.edu'\nRestorationBucket = \"aptrust.restore.universityname.edu\"\nDownloadDir = \"/home/josie/downloads\"\nAptrustApiUser = \"archivist@example.edu\"\nAptrustApiKey = \"f887afc5e1624eda92ae1a5aecdf210c\"\n</code></pre> <p>If you prefer not to put your AWS keys in the config file, you can put them into environment variables called <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>.</p> <p>The config file should include the following variables:</p> <ul> <li> <p>ReceivingBucket: The name of the S3 bucket that will hold your uploaded APTrust bags that are awaiting ingest. E.g. <code>aptrust.receiving.college.edu</code>.</p> </li> <li> <p>RestorationBucket: The name of the S3 bucket that will hold your restored APTrust bags. E.g. <code>aptrust.restore.college.edu</code>.</p> </li> <li> <p>DownloadDir: The local directory in which to save files downloaded from your APTrust restoration bucket. The APTrust config currently does not expand <code>~</code> to your home directory, so use an absolute path to be safe.</p> </li> <li> <p>AptrustApiUser: The email address for logging in to APTrust's Pharos REST API.</p> </li> <li> <p>AptrustApiKey: Your API key for the Pharos REST API. This key must match the user email. (That is, joe@example.com cannot log in with a key that was issued to beth@example.com.)</p> </li> </ul> <p>If you save your config file as <code>~/.aptrust_partner.conf</code> in Linux/Mac or as <code>%HOMEPATH%\\.aptrust_partner.conf</code> under Windows, you will not have to specify a --config option when you run the tools. Otherwise, run the tools with the --config file pointing to the full path of your configuration file.</p> <p>Below is a screenshot of apt_list showing the contents of an AWS receiving bucket.</p> <p></p> <p>apt_check_ingest shows the ingest status of items that match a specified file name.</p> <p></p>"},{"location":"partner_tools/","title":"APTrust Partner Tools","text":"<p>The aptrust command-line utility (apt-cmd, aka Partner Tools) enables you to create and validate bags, manage S3 files, and query data in the APTrust Registry. This tool replaces the older version 2.x partner tools which did not have bag creation features and worked only with Pharos.</p> <p>You can create workflows with apt-cmd that include:</p> <ul> <li>creating a bag</li> <li>validating the bag</li> <li>uploading the bag to an S3 bucket</li> <li>checking the APTrust registry to see when the bag was ingested</li> <li>retrieving object and file details, including checksums and PREMIS events, from the APTrust registry</li> </ul> <p>For bag creating and validation, the current release supports tarred bags only. Though access to the APTrust registry is limited to APTrust depositors, anyone can use apt-cmd's bagging and S3 features.</p>"},{"location":"partner_tools/#downloads","title":"Downloads","text":"Platform Architecture Version SHA-256 Windows Intel 64-bit v3.0.0-beta b12d7daf68ca2a2ea99ea208143e4571cf49fd8221ea1998a9b4f5db9774b631 Mac Intel Intel 64-bit v3.0.0-beta 1b5ceb015744e9ca818e5526f0940988fd4dad7f56c1bde105762bd89522265b Mac ARM Apple Silicon (M series) v3.0.0-beta 0327e04b44137ce856b342542563133b9f8184364513394013bf200939dd6c8e Linux Intel 64-bit v3.0.0-beta 88d13960e50478066a6426ffd49e4763feece4642b7420e0d2e4f8d9412e9c88 <p>APTrust partner tools are open source, distributed under the BSD 2-clause license. The source code is available on github at https://github.com/APTrust/partner-tools.</p>"},{"location":"partner_tools/#help-and-troubleshooting","title":"Help and Troubleshooting","text":"<p>You can get help for any apt-cmd command using the <code>--help</code> flag. For example, <code>apt-cmd --help</code> shows the list of available commands. To get help with a specific command, try <code>apt-cmd [command] --help</code>. For example, <code>apt-cmd bag create --help</code>.</p> <p>All operations support the <code>--debug</code> flag. When supplied, apt-cmd will print out additional detailed information about what it's doing.</p>"},{"location":"partner_tools/#exit-codes","title":"Exit Codes","text":"<p>The apt-cmd tool returns consistent exit codes for all operations. If you're using apt-cmd in scripts, check the exit code of each call to ensure it succeeded.</p> <p>An exit code of 0 (zero) indicates the call succeeded. A non-zero exit code means the call failed.</p> Code Meaning 0 The operation completed without errors. 1 The operation failed due to a runtime error. Causes may include a network error, full disk, lack of file permissions, etc. 2 The bag you validated turned out to be invalid. Check the error output for details. 3 The operation failed due to a user error. This is almost always caused by missing or invalid command-line parameters, or missing/invalid configuration settings. 4 The operation did not complete because an external service responded with an error. Common causes including passing bad authentication values to the APTrust registry or the remote S3 service, requesting an object that doesn't exist, and requesting an item you're not authorized to access."},{"location":"partner_tools/#creating-a-bag","title":"Creating a Bag","text":"<p>You can create bags that conform to the APTrust, BTR or empty BagIt profile. If you specify the empty profile, apt-cmd will create a valid bag with the tags and manifests you specify.</p> <p>The example below demonstrates how to speficy flags and tag values.</p> <p>For tag values, use the format \"filename.txt/Tag-Name=tag value\". If you omit the file name, it defaults to bag-info.txt. For example, the following two tags will both be written into the Source-Organization tag in bag-info.txt:</p> <pre><code>  --tags=\"bag-info.txt/Source-Organization=Faber College\"\n  --tags=\"Source-Organization=Faber College\"\n</code></pre> <p>Note that tag values are quoted in their entirety, both the name and the value.</p> <p>Apply double quotes to values containing special characters such as spaces and symbols and to values containing environment variables that you want to expand, such as \"$HOME\".</p> <p>Apply single quotes to values containing symbols that you don't want the shell to expand, such as curly braces, ampersands, and random dollar signs.</p> <p>You can specify any tag files and tag names you want.</p> <p>The following example packages the directory /home/josie/photos according to the APTrust BagIt profile and writes the tarred bag into /home/josie/bags/photos.tar.</p> <p>This bag will include md5 and sha256 manifests and tag manifests. It will also include the specified tags in the bag-info.txt and aptrust-info.txt tag files.</p> <pre><code>  apt-cmd bag create \\\n    --profile=aptrust \\\n    --manifest-algs='md5,sha256' \\\n    --output-file='/home/josie/bags/photos.tar' \\\n    --bag-dir='/home/josie/photos' \\\n    --tags='aptrust-info.txt/Title=My Bag of Photos' \\\n    --tags='aptrust-info.txt/Access=Institution' \\\n    --tags='aptrust-info.txt/Storage-Option=Standard' \\\n    --tags='bag-info.txt/Source-Organization=Faber College' \\\n    --tags='Custom-Tag=Single quoted because it {contains} $weird &amp;characters'\n</code></pre>"},{"location":"partner_tools/#troubleshooting","title":"Troubleshooting","text":"<ol> <li>Use the --debug flag to get the program to tell what it thinks it's    supposed to be doing.</li> <li>If you use backslashes, as in the example able, be sure there are no    trailing spaces or any characters other than a newline following the    backslash.</li> </ol>"},{"location":"partner_tools/#limitations","title":"Limitations","text":"<ol> <li>This tool currently supports only APTrust, BTR, and empty/generic    BagIt profiles.</li> <li>For now, all bags will be output as tar files.</li> <li>This tool currently supports only the md5, sha1, sha256, and sha512    algorithms for manifests and tag manifests.</li> <li>This tool currently will not generate a fetch.txt file.</li> </ol>"},{"location":"partner_tools/#validating-a-bag","title":"Validating a Bag","text":"<p>Currently, apt-cmd validates only tarred bags. The following commands validate a bag according to the APTrust BagIt profile:</p> <pre><code>  apt-cmd bag validate my_bag.tar\n  apt-cmd bag validate -p aptrust my_bag.tar\n</code></pre> <p>To validate a bag using the Beyond the Repository (BTR) profile:</p> <pre><code>  apt-cmd bag validate -p btr my_bag.tar\n</code></pre> <p>To validate a bag using the empty profile:</p> <pre><code>  apt-cmd bag validate -p empty my_bag.tar\n</code></pre> <p>The empty profile simply ensures the bag is valid according to the general BagIt specification.</p>"},{"location":"partner_tools/#limitations_1","title":"Limitations","text":"<p>The validator only works with tarred bags and will not validate fetch.txt files.</p>"},{"location":"partner_tools/#s3-commands","title":"S3 Commands","text":"<p>apt-cmd can upload to and download from any service with an S3-compliant API. It can also list bucket contents in JSON or text formats, and delete items from S3.</p> <p>To access S3 services, you'll need to S3 credentials, as specified in the Configuration Settings section below.</p>"},{"location":"partner_tools/#uploading-a-file-to-an-s3-bucket","title":"Uploading a File to an S3 Bucket","text":"<p>apt-cmd can upload a file to any S3-compatible service. For this to work, you will need to have APTRUST_AWS_KEY and APTRUST_AWS_SECRET set in your environment, or in a config file specified with the --config flag.</p>"},{"location":"partner_tools/#examples","title":"Examples","text":"<p>Upload file photo.jpg to Amazon's S3 service:</p> <pre><code>    apt-cmd s3 upload --host=s3.amazonaws.com --bucket=\"my-bucket\" photo.jpg\n</code></pre> <p>Upload the same file, but call it renamed.jpg in S3:</p> <pre><code>    apt-cmd s3 upload --host=s3.amazonaws.com  \\\n             --bucket=\"my-bucket\" \\\n             --key='renamed.jpg' \\\n             photo.jpg\n</code></pre>"},{"location":"partner_tools/#listing-the-contents-of-an-s3-bucket","title":"Listing the Contents of an S3 Bucket","text":"<p>You can list files from any S3-compatible service. For this to work, you will need to have APTRUST_AWS_KEY and APTRUST_AWS_SECRET set in your environment, or in a config file specified with the --config flag.</p> <p>List output is in JSON format, unless you specify <code>--format=text</code>.</p>"},{"location":"partner_tools/#examples_1","title":"Examples","text":"<p>List items in my_bucket with prefix \"photo\":</p> <pre><code>    apt-cmd s3 list --host=s3.amazonaws.com --bucket=my_bucket --prefix=photo\n</code></pre> <p>List 10 items in my_bucket with prefix \"photo\", using plain text output:</p> <pre><code>    apt-cmd s3 list --host=s3.amazonaws.com \\\n                    --bucket=my_bucket \\\n                    --prefix=photo \\\n                    --maxitems=10 \\\n                    --format=text\n</code></pre> <p>List items in sub-folder \"music\" of my_bucket. Note the trailing slash after \"music/\".</p> <pre><code>    apt-cmd s3 list --host=s3.amazonaws.com --bucket=my_bucket --prefix=music/\n</code></pre> <p>List items in a nested folder. Again, note the trailing slash:</p> <pre><code>    apt-cmd s3 list --host=s3.amazonaws.com --bucket=my_bucket --prefix=music/danielle_ponder/\n</code></pre>"},{"location":"partner_tools/#downloading-an-s3-file","title":"Downloading an S3 File","text":"<p>You can download files from any S3-compatible service. For this to work, you will need to have APTRUST_AWS_KEY and APTRUST_AWS_SECRET set in your environment, or in a config file specified with the --config flag.</p>"},{"location":"partner_tools/#examples_2","title":"Examples","text":"<p>Download a file from Amazon's S3 service into the current directory:</p> <pre><code>    apt-cmd s3 download --host=s3.amazonaws.com --bucket=\"my-bucket\" --key='photo_001.jpg'\n</code></pre> <p>Download the same file and save it with a custom name on your desktop:</p> <pre><code>    apt-cmd s3 download --host=s3.amazonaws.com  \\\n               --bucket=\"my-bucket\" \\\n               --key='photo_001.jpg' \\\n               --save-as=\"$HOME/Desktop/vacation.jpg\"\n</code></pre>"},{"location":"partner_tools/#deleting-an-s3-file","title":"Deleting an S3 File","text":"<p>You can delete objects from any S3-compatible service. For this to work, you will need to have APTRUST_AWS_KEY and APTRUST_AWS_SECRET set in your environment, or in a config file specified with the --config flag.</p>"},{"location":"partner_tools/#example","title":"Example","text":"<p>Delete object photo.jpg from my-bucket on AWS S3:</p> <pre><code>    apt-cmd s3 delete --host=s3.amazonaws.com --bucket=\"my-bucket\" --key='photo.jpg'\n</code></pre> <p>Note: This returns exit status zero and <code>'{ \"result\": \"OK\" }'</code> if the key is successfully deleted or if the key wasn't in the bucket to begin with.</p>"},{"location":"partner_tools/#registry-commands","title":"Registry Commands","text":"<p>Registry commands retrieve information from the APTrust registry. You'll need APTrust credentials to query the Registry. See Configuration Settings below for info on how to pass these credentials to apt-cmd.</p>"},{"location":"partner_tools/#listing-registry-work-items","title":"Listing Registry Work Items","text":"<p>List work items from the APTrust registry, or run a special \"quick report.\"</p> <p>You'll typically want to list work items so you can track the progress of an ingest or restoration.</p> <p>Note that when filtering Work Items, Objects or Files using any of the list commands, you can supply filters as name-value pairs on the command line. These pairs do not use the double-dash (--) prefix.</p>"},{"location":"partner_tools/#examples_3","title":"Examples","text":"<p>List recent ingests:</p> <pre><code>  apt-cmd registry list workitems action='Ingest' sort='date_processed__desc'\n</code></pre> <p>List all work items since April 6, 2023:</p> <pre><code>  apt-cmd registry list workitems date_processed__gteq='2023-04-06' sort='date_processed__desc'\n</code></pre> <p>List failed work items:</p> <pre><code>  apt-cmd registry list workitems status='Failed' sort='date_processed__desc'\n</code></pre> <p>List work items pertaining to a tar file you uploaded:</p> <pre><code>  apt-cmd registry list workitems name='bag-of-photos.tar'\n</code></pre> <p>List work items pertaining to a bag with a specific etag:</p> <pre><code>  apt-cmd registry list workitems etag='987654321-100'\n</code></pre> <p>List work items pertaining to a specific intellectual object:</p> <pre><code>  apt-cmd registry list workitems object_identifier='test.edu/TestBag'\n</code></pre> <p>List restorations or deletions of a specific file:</p> <pre><code>  apt-cmd registry list workitems generic_file_identifier='test.edu/TestBag/data/photo1.jpg'\n</code></pre>"},{"location":"partner_tools/#quick-reports","title":"Quick Reports","text":"<p>List all items from the past 30 days that are still in process:</p> <pre><code>  apt-cmd registry list workitems --report=inprocess\n</code></pre> <p>List all items from the past 30 days that failed or were cancelled:</p> <pre><code>  apt-cmd registry list workitems --report=problems\n</code></pre> <p>List all restorations from the past 30 days:</p> <pre><code>  apt-cmd registry list workitems --report=restorations\n</code></pre> <p>When running quick reports, this tool ignores all other query params.</p>"},{"location":"partner_tools/#workitem-list-filter-options","title":"WorkItem List Filter Options","text":"<p>When querying for Work Items, apt-cmd supports the following filter options:</p> Name DataType Description action string The action, one of: Delete, Restore Object, Restore File, Glacier Restore, Ingest action__in string You can specify this multiple times to get results that include any of the named actions. For example, to get work items pertaining to any type of restoration, specify <code>action_in=\"Restore Object\" action_in=\"Restore File\" action_in=\"Glacier Restore\"</code> alt_identifier string Return work items pertaining to objects with this alternate identifier. bag_date__gteq date string 'yyyy-mm-dd' Return work items pertaining to bags created on or after this date. bag_date__lteq date string 'yyyy-mm-dd' Return work items pertaining to bags created on or before this date. bag_group_identifier string Return work items pertaining to bags having this bag group identifier. (Exact match only. Group identifier prefixes won't work here.) bagit_profile_identifier string Return work items pertaining to bags having this BagIt profile identifier. Allowed values are https://github.com/dpscollaborative/btr_bagit_profile/releases/download/1.0/btr-bagit-profile.json (for the BTR profile), and https://raw.githubusercontent.com/APTrust/preservation-services/master/profiles/aptrust-v2.2.json (for the APTrust profile). date_processed__gteq date string 'yyyy-mm-dd' Return items last touched by a worker process on or after this date. date_processed__lteq date string 'yyyy-mm-dd' Return items last touched by a worker process on or before this date. etag string Return work items pertaining to an uploaded bag with this etag. generic_file_id integer Return work items pertaining to this generic file. generic_file_id__is_null string Set this to \"true\" to retrieve work items with an empty generic file identifier. Results will include only object-level work items, such as ingests, object deletions and object restorations. generic_file_identifier string Return work items pertaining to the generic file with this identifier. intellectual_object_id integer Return work items pertaining to this intellectual object. Note that for ingests, the object id will be empty until the ingest completes. intellectual_object_id__is_null string Set this to \"true\" to include work items with an empty intellectual object id. This will return ingests that have not yet completed. All other work items are associated with an object. name string The name of the tar file you want to check on. This is the name of the file you uploaded to your receiving bucket for ingest. For example, \"virginia.edu/bag-of-photos.tar\". needs_admin_review string Set this to \"true\" if you want to retrieve work items that have been flagged as problematic, requiring review from an APTrust administrator. node__is_null string Set this to \"true\" to retrieve work items with a null worker node. These items are currently not being worked on by any process. Items are in this state when awaiting processing and when processing has completed. node__not_null string Set this to \"true\" to retrieve items that are undergoing active processing by an ingest, restoration or deletion worker. object_identifier string Return items associated with this intellectual object identifier. queued_at__is_null date string 'yyyy-mm-dd' Return items queued for work on or after this date. queued_at__not_null date string 'yyyy-mm-dd' Return items queued for work on or before this date. retry string Set this to \"true\" to retrieve items that are eligible for processing. Set to \"false\" to retrieve problematic items that either will not be retried or require manually requeueing. size__gteq integer Return work items associated with files or objects containing at least this number of bytes. size__lteq integer Return work items associated with files or objects containing no more than this number of bytes. stage string Return items in this stage of processing. Allowed values: Available in S3, Cleanup, Copy To Staging, Fetch, Format Identification, Package, Receive, Record, Reingest Check, Requested, Resolve, Restoring, Storage Validation, Store, Unpack, Validate. stage__in string Specify this filter multiple times to retrieve items in any one of a number of stages. For example, to retrieve items in the Store, Unpack, or Validate stages, use <code>stage__in=Store stage__in=Unpack stage_in=Validate</code> status string Retrieve items having this status. Values include Cancelled, Failed, Pending, Started, Success, Suspended. status__in string Specify this filter multiple times to retrieve items having any of a number of statuses. For example, to retrieve items with Pending and Started status, use <code>status__in=Pending status__in=Started</code>. storage_option string Retrieve items pertaining to objects or files having the specified storage option. Available values : Glacier-Deep-OH, Glacier-Deep-OR, Glacier-Deep-VA, Glacier-OH, Glacier-OR, Glacier-VA, Standard, Wasabi-OR, Wasabi-VA user string (email address) Return work items initiated by the user with this email address."},{"location":"partner_tools/#workitem-list-paging-and-sort-options","title":"WorkItem List Paging and Sort Options","text":"<p>By default, the <code>list workitems</code> command returns the first 25 results, sorting items by id. You can override these defaults with the following settings.</p> Name DataType Description per_page integer The number of results to return per request. Default is 25. Max is 1000. page integer The page of results you want to retrieve. Default is 1. sort string Sort results using the specified column. You can sort on any field listed in the JSON sample below. Append \"__desc\" to the field name to do a descending (reverse) sort. For example, <code>sort=name</code> sorts by the name of the tar file, while <code>sort=name__desc</code> does a reverse sort by name."},{"location":"partner_tools/#workitem-list-response-format","title":"WorkItem List Response Format","text":"<p>The <code>workitem list</code> command returns JSON in the following format. Note that <code>count</code> indicates the total number of results, while <code>next</code> and <code>previous</code> are URLs pointing to the next and previous pages of results.</p> <pre><code>{\n  \"count\": 0,\n  \"next\": \"string\",\n  \"previous\": \"string\",\n  \"items\": [\n    {\n      \"id\": 0,\n      \"action\": \"Delete\",\n      \"alt_identifier\": \"string\",\n      \"aptrust_approver\": \"user@example.com\",\n      \"bagit_profile_identifier\": \"https://github.com/dpscollaborative/btr_bagit_profile/releases/download/1.0/btr-bagit-profile.json\",\n      \"bag_date\": \"2023-04-20T17:34:07.911Z\",\n      \"bag_group_identifier\": \"string\",\n      \"bucket\": \"string\",\n      \"created_at\": \"2023-04-20T17:34:07.911Z\",\n      \"date_processed\": \"2023-04-20T17:34:07.911Z\",\n      \"etag\": \"string\",\n      \"generic_file_id\": 0,\n      \"generic_file_identifier\": \"string\",\n      \"institution_id\": 0,\n      \"institution_name\": \"string\",\n      \"institution_identifier\": \"string\",\n      \"inst_approver\": \"user@example.com\",\n      \"intellectual_object_id\": 0,\n      \"internal_sender_identifier\": \"string\",\n      \"name\": \"string\",\n      \"needs_admin_review\": true,\n      \"node\": \"string\",\n      \"note\": \"string\",\n      \"object_identifier\": \"string\",\n      \"outcome\": \"Failure\",\n      \"pid\": 0,\n      \"queued_at\": \"2023-04-20T17:34:07.911Z\",\n      \"retry\": true,\n      \"size\": 0,\n      \"source_organization\": \"string\",\n      \"stage\": \"Available in S3\",\n      \"stage_started_at\": \"2023-04-20T17:34:07.912Z\",\n      \"status\": \"Cancelled\",\n      \"storage_option\": \"Glacier-Deep-OH\",\n      \"updated_at\": \"2023-04-20T17:34:07.912Z\",\n      \"user\": \"user@example.com\"\n    }\n  ]\n}\n</code></pre>"},{"location":"partner_tools/#retrieving-a-single-registry-work-item","title":"Retrieving a Single Registry Work Item","text":"<p>To retrieve a single WorkItem record from the APTrust Registry, use the command below. Note that id is an integer.</p> <pre><code>  apt-cmd registry get workitem &lt;id&gt;\n</code></pre>"},{"location":"partner_tools/#workitem-get-response-format","title":"WorkItem Get Response Format","text":"<p>The command <code>aptrust registry get workitem</code> returns JSON in the following format:</p> <pre><code>{\n  \"id\": 0,\n  \"action\": \"Restore Object\",\n  \"alt_identifier\": \"string\",\n  \"aptrust_approver\": \"user@example.com\",\n  \"bagit_profile_identifier\": \"https://github.com/dpscollaborative/btr_bagit_profile/releases/download/1.0/btr-bagit-profile.json\",\n  \"bag_date\": \"2023-04-20T17:45:43.969Z\",\n  \"bag_group_identifier\": \"string\",\n  \"bucket\": \"string\",\n  \"created_at\": \"2023-04-20T17:45:43.970Z\",\n  \"date_processed\": \"2023-04-20T17:45:43.970Z\",\n  \"etag\": \"string\",\n  \"generic_file_id\": 0,\n  \"generic_file_identifier\": \"string\",\n  \"institution_id\": 0,\n  \"institution_name\": \"string\",\n  \"institution_identifier\": \"string\",\n  \"inst_approver\": \"user@example.com\",\n  \"intellectual_object_id\": 0,\n  \"internal_sender_identifier\": \"string\",\n  \"name\": \"string\",\n  \"needs_admin_review\": true,\n  \"node\": \"string\",\n  \"note\": \"string\",\n  \"object_identifier\": \"string\",\n  \"outcome\": \"Success\",\n  \"pid\": 0,\n  \"queued_at\": \"2023-04-20T17:45:43.970Z\",\n  \"retry\": true,\n  \"size\": 0,\n  \"source_organization\": \"string\",\n  \"stage\": \"Available in S3\",\n  \"stage_started_at\": \"2023-04-20T17:45:43.970Z\",\n  \"status\": \"Cancelled\",\n  \"storage_option\": \"Glacier-Deep-OH\",\n  \"updated_at\": \"2023-04-20T17:45:43.970Z\",\n  \"user\": \"user@example.com\"\n}\n</code></pre>"},{"location":"partner_tools/#listing-registry-objects","title":"Listing Registry Objects","text":"<p>You can list objects from the APTrust Registry, with filters.</p>"},{"location":"partner_tools/#examples_4","title":"Examples","text":"<p>List 20 objects ordered by identifer:</p> <pre><code>  apt-cmd registry list objects sort='identifier' per_page='20'\n</code></pre> <p>List 20 objects reverse ordered by identifer:</p> <pre><code>  apt-cmd registry list objects sort='identifier__desc' per_page='20'\n</code></pre> <p>List objects created after April 6, 2023</p> <pre><code>  apt-cmd registry list files created_at__gteq='2023-04-06'\n</code></pre>"},{"location":"partner_tools/#object-list-filter-options","title":"Object List Filter Options","text":"Name DataType Description access string Return objects with this access setting. Available values : consortia, institution, restricted alt_identifier string Return objects with this alternate identifier. alt_identifier__starts_with string Return objects whose alternate identifier starts with the speficied string. bag_group_identifier string Return objects with this bag group identifier. bag_group_identifier__starts_with string Return objects whose bag group identifier starts with the specified string. bagit_profile_identifier string Return objects with this BagIt profile identifier. Available values : https://github.com/dpscollaborative/btr_bagit_profile/releases/download/1.0/btr-bagit-profile.json (BTR profile) and https://raw.githubusercontent.com/APTrust/preservation-services/master/profiles/aptrust-v2.2.json (APTrust profile). created_at__gteq date string 'yyyy-mm-dd' Return objects created on or after the given date. created_at__lteq date string 'yyyy-mm-dd' Return objects created on or before the given date. etag string Return the object with this etag. file_count__gteq integer Return objects containing at least this number of files. file_count__lteq integer Return objects containing no more than this number of files. identifier string Return the object with this identifier. internal_sender_identifier string Return the object with this internal sender identifier. size__gteq integer Return objects whose size is at least this number of bytes. size__lteq integer Return objects whose size is no more than this number of bytes. state string Return objects with this state. A = Active, D = Deleted. Available values: A, D. storage_option string Return objects with the specified storage option. Available values: Glacier-Deep-OH, Glacier-Deep-OR, Glacier-Deep-VA, Glacier-OH, Glacier-OR, Glacier-VA, Standard, Wasabi-OR, Wasabi-VA. updated_at__gteq date string 'yyyy-mm-dd' Return objects updated on or after the given timestamp. updated_at__lteq date string 'yyyy-mm-dd' Return objects updated on or before the given timestamp."},{"location":"partner_tools/#object-list-paging-and-sort-options","title":"Object List Paging and Sort Options","text":"<p>By default, the <code>list objects</code> command returns the first 25 results, sorting objects by id. You can override these defaults with the following settings.</p> Name DataType Description per_page integer The number of results to return per request. Default is 25. Max is 1000. page integer The page of results you want to retrieve. Default is 1. sort string Sort results using the specified column. You can sort on any field listed in the JSON sample below. Append \"__desc\" to the field name to do a descending (reverse) sort. For example, <code>sort=identifier</code> sorts by the object identifier, while <code>sort=identifier__desc</code> does a reverse sort by identifier."},{"location":"partner_tools/#object-list-response-format","title":"Object List Response Format","text":"<p>The <code>list objects</code> command returns JSON with the following format. Note that <code>count</code> is the total number of resuls matching your query, while <code>next</code> and <code>previous</code> are URLs pointing to the next and previous pages of results.</p> <pre><code>{\n  \"count\": 0,\n  \"next\": \"string\",\n  \"previous\": \"string\",\n  \"items\": [\n    {\n      \"id\": 0,\n      \"title\": \"string\",\n      \"description\": \"string\",\n      \"identifier\": \"string\",\n      \"alt_identifier\": \"string\",\n      \"access\": \"consortia\",\n      \"bag_name\": \"string\",\n      \"institution_id\": 0,\n      \"created_at\": \"2023-04-20T18:25:28.513Z\",\n      \"updated_at\": \"2023-04-20T18:25:28.513Z\",\n      \"state\": \"A\",\n      \"etag\": \"string\",\n      \"bag_group_identifier\": \"string\",\n      \"storage_option\": \"Glacier-Deep-OH\",\n      \"bagit_profile_identifier\": \"https://github.com/dpscollaborative/btr_bagit_profile/releases/download/1.0/btr-bagit-profile.json\",\n      \"source_organization\": \"string\",\n      \"internal_sender_identifier\": \"string\",\n      \"internal_sender_description\": \"string\",\n      \"institution_name\": \"string\",\n      \"institution_identifier\": \"string\",\n      \"institution_type\": \"MemberInstitution\",\n      \"institution_parent_id\": 0,\n      \"file_count\": 0,\n      \"size\": 0,\n      \"payload_file_count\": 0,\n      \"payload_size\": 0\n    }\n  ]\n}\n</code></pre>"},{"location":"partner_tools/#retrieving-a-single-registry-object","title":"Retrieving a Single Registry Object","text":"<p>You can retrieve objects from the Registry by identifier or by id. Object identifiers are strings, such as 'example.edu/photos'. Ids are numeric.</p>"},{"location":"partner_tools/#examples_5","title":"Examples","text":"<pre><code>apt-cmd registry get object identifier=&lt;object_identifier&gt;\napt-cmd registry get object id=&lt;object_id&gt;\n</code></pre>"},{"location":"partner_tools/#get-object-response-format","title":"Get Object Response Format","text":"<p>The <code>get object</code> command returns JSON in the following format:</p> <pre><code>{\n  \"id\": 0,\n  \"title\": \"string\",\n  \"description\": \"string\",\n  \"identifier\": \"string\",\n  \"alt_identifier\": \"string\",\n  \"access\": \"consortia\",\n  \"bag_name\": \"string\",\n  \"institution_id\": 0,\n  \"created_at\": \"2023-04-20T18:52:35.412Z\",\n  \"updated_at\": \"2023-04-20T18:52:35.412Z\",\n  \"state\": \"A\",\n  \"etag\": \"string\",\n  \"bag_group_identifier\": \"string\",\n  \"storage_option\": \"Glacier-Deep-OH\",\n  \"bagit_profile_identifier\": \"https://github.com/dpscollaborative/btr_bagit_profile/releases/download/1.0/btr-bagit-profile.json\",\n  \"source_organization\": \"string\",\n  \"internal_sender_identifier\": \"string\",\n  \"internal_sender_description\": \"string\",\n  \"institution_name\": \"string\",\n  \"institution_identifier\": \"string\",\n  \"institution_type\": \"MemberInstitution\",\n  \"institution_parent_id\": 0,\n  \"file_count\": 0,\n  \"size\": 0,\n  \"payload_file_count\": 0,\n  \"payload_size\": 0\n}\n</code></pre>"},{"location":"partner_tools/#listing-registry-files","title":"Listing Registry Files","text":"<p>The <code>list files</code> command lists files from the APTrust Registry, applying whatever filters you specify. Note that the file JSON returned by this call includes only summary information for each file, while the <code>get file</code> call returns more detailed info.</p>"},{"location":"partner_tools/#examples_6","title":"Examples","text":"<p>List files belonging to object test.edu/my_bag, ordered by identifer:</p> <pre><code>  apt-cmd registry list files intellectual_object_identifier='test.edu/my_bag' sort='identifier'\n</code></pre> <p>List only the first 10 files from that same bag:</p> <pre><code>  apt-cmd registry list files intellectual_object_identifier='test.edu/my_bag' sort='identifier' per_page=10\n</code></pre> <p>List files created after April 6, 2023</p> <pre><code>  apt-cmd registry list files created_at__gteq='2023-04-06'\n</code></pre>"},{"location":"partner_tools/#file-list-filter-options","title":"File List Filter Options","text":"Name DataType Description created_at__gteq date string 'yyyy-mm-dd' Return files created on or after the given timestamp. created_at__lteq date string 'yyyy-mm-dd' Return files created on or before the given timestamp. identifier string Return the file with this identifier. intellectual_object_id integer Return files belonging to the specified intellectual object. last_fixity_check__gteq date string 'yyyy-mm-dd' Return files whose last fixity check was on or after the given timestamp. last_fixity_check__lteq date string 'yyyy-mm-dd' Return files whose last fixity check was on or before the given timestamp. size__gteq integer Return files whose size is at least this number of bytes. size__lteq integer Return files whose size is no more than this number of bytes. state string Return files with this state. A = Active, D = Deleted. Available values: A, D. storage_option string Return files with the specified storage option. Available values: Glacier-Deep-OH, Glacier-Deep-OR, Glacier-Deep-VA, Glacier-OH, Glacier-OR, Glacier-VA, Standard, Wasabi-OR, Wasabi-VA. updated_at__gteq date string 'yyyy-mm-dd' Return files updated on or after the given timestamp. updated_at__lteq date string 'yyyy-mm-dd' Return files updated on or before the given timestamp."},{"location":"partner_tools/#file-list-paging-and-sort-options","title":"File List Paging and Sort Options","text":"<p>By default, the <code>list files</code> command returns the first 25 results, sorting files by id. You can override these defaults with the following settings.</p> Name DataType Description per_page integer The number of results to return per request. Default is 25. Max is 1000. page integer The page of results you want to retrieve. Default is 1. sort string Sort results using the specified column. You can sort on any field listed in the JSON sample below. Append \"__desc\" to the field name to do a descending (reverse) sort. For example, <code>sort=identifier</code> sorts by the file identifier, while <code>sort=identifier__desc</code> does a reverse sort by identifier."},{"location":"partner_tools/#file-list-response-format","title":"File List Response Format","text":"<p>The <code>list files</code> command returns JSON with the following format. Note that <code>count</code> is the total number of resuls matching your query, while <code>next</code> and <code>previous</code> are URLs pointing to the next and previous pages of results.</p> <pre><code>{\n  \"count\": 0,\n  \"next\": \"string\",\n  \"previous\": \"string\",\n  \"items\": [\n    {\n      \"id\": 0,\n      \"file_format\": \"string\",\n      \"size\": 0,\n      \"identifier\": \"string\",\n      \"intellectual_object_id\": 0,\n      \"object_identifier\": \"string\",\n      \"access\": \"consortia\",\n      \"state\": \"A\",\n      \"last_fixity_check\": \"2023-04-20T18:55:14.164Z\",\n      \"institution_id\": 0,\n      \"institution_name\": \"string\",\n      \"institution_identifier\": \"string\",\n      \"storage_option\": \"Glacier-Deep-OH\",\n      \"uuid\": \"3fa85f64-5717-4562-b3fc-2c963f66afa6\",\n      \"md5\": \"string\",\n      \"sha1\": \"string\",\n      \"sha256\": \"string\",\n      \"sha512\": \"string\",\n      \"created_at\": \"2023-04-20T18:55:14.165Z\",\n      \"updated_at\": \"2023-04-20T18:55:14.165Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"partner_tools/#retrieving-a-single-registry-file","title":"Retrieving a Single Registry File","text":"<p>You can retrieve a JSON record from the APTrust registry describing a generic file with a specified identifier or id. File identifiers are strings, such as 'example.edu/photos/data/image1.jpg'. Ids are numeric.</p> <p>Note that this call returns not only the generic file info, but also all of the checksums and PREMIS events associated with the file.</p>"},{"location":"partner_tools/#examples_7","title":"Examples","text":"<pre><code>apt-cmd registry get file &lt;file_identifier&gt;\napt-cmd registry get file &lt;file_id&gt;\n</code></pre>"},{"location":"partner_tools/#get-file-response-format","title":"Get File Response Format","text":"<p>The <code>get file</code> command returns JSON in the following format:</p> <pre><code>{\n  \"id\": 0,\n  \"file_format\": \"string\",\n  \"size\": 0,\n  \"identifier\": \"string\",\n  \"intellectual_object_id\": 0,\n  \"state\": \"A\",\n  \"last_fixity_check\": \"2023-04-20T19:09:44.674Z\",\n  \"institution_id\": 0,\n  \"storage_option\": \"Glacier-Deep-OH\",\n  \"uuid\": \"3fa85f64-5717-4562-b3fc-2c963f66afa6\",\n  \"premis_events\": [\n    {\n      \"id\": 0,\n      \"agent\": \"string\",\n      \"date_time\": \"2023-04-20T19:09:44.674Z\",\n      \"detail\": \"string\",\n      \"event_type\": \"access assignment\",\n      \"generic_file_id\": 0,\n      \"identifier\": \"3fa85f64-5717-4562-b3fc-2c963f66afa6\",\n      \"institution_id\": 0,\n      \"intellectual_object_id\": 0,\n      \"object\": \"string\",\n      \"old_uuid\": \"3fa85f64-5717-4562-b3fc-2c963f66afa6\",\n      \"outcome\": \"Failure\",\n      \"outcome_detail\": \"string\",\n      \"outcome_information\": \"string\",\n      \"created_at\": \"2023-04-20T19:09:44.674Z\",\n      \"updated_at\": \"2023-04-20T19:09:44.674Z\"\n    }\n  ],\n  \"checksums\": [\n    {\n      \"id\": 0,\n      \"algorithm\": \"md5\",\n      \"datetime\": \"2023-04-20T19:09:44.674Z\",\n      \"digest\": \"string\",\n      \"generic_file_id\": 0\n    }\n  ],\n  \"storage_records\": [\n    {\n      \"id\": 0,\n      \"generic_file_id\": 0,\n      \"url\": \"string\"\n    }\n  ],\n  \"created_at\": \"2023-04-20T19:09:44.674Z\",\n  \"updated_at\": \"2023-04-20T19:09:44.674Z\"\n}\n</code></pre>"},{"location":"partner_tools/#configuration-settings","title":"Configuration Settings","text":"<p>apt-cmd will read configuration values from a config file if you specify one with the --config flag. Otherwise, it will read config values from the environment. The testconfig.env file shows a sample configuration used for testing.</p> <p>Config files can use .env, JSON, or YAML format. Just be sure to include the correct file extension (.env, .yml, .yaml, or .json) so apt-cmd knows how to parse the file.</p> <p>You may find it useful to maintain separate config file for separate profiles. For example, you may want to store S3 credentials for Amazon in aws.env, credentials for Wasabi in wasabi.env, and for Minio in minio.env.</p> <p>Or, you can skip config files altogether and use environment variables like so:</p> <pre><code>  APTRUST_AWS_KEY=my_key APTRUST_AWS_SECRET=my_secrete apt-cmd s3 upload --host=s3.amazonaws.com --bucket=\"my-bucket\" photo.jpg\n</code></pre> <p>apt-cmd uses the following settings.</p> Name Description APTRUST_AWS_KEY Access Key ID to access S3. Required only for S3 operations. Works with any S3-compatible service. APTRUST_AWS_SECRET Secret access key to access S3. Required only for S3 operations. Works with any S3-compatible service. APTRUST_REGISTRY_URL URL of the APTrust registry you want to access. Production is https://repo.aptrust.org. Demo is https://demo.aptrust.org. Required only for registry operations. APTRUST_REGISTRY_API_VERSION Version of the current registry API. For now, this should be <code>v3</code>. Required only for registry operations. APTRUST_REGISTRY_EMAIL The email address associated with your APTrust registry account. Required only for registry operations. APTRUST_REGISTRY_API_KEY The API key associated with your APTrust registry account. Required only for registry operations."},{"location":"quick_start/","title":"Quick Start","text":""},{"location":"quick_start/#logging-in","title":"Logging In","text":"<p>You can log in to Registry, APTrust's online registry, at the URLs below:</p> <ul> <li>Staging Repository - https://staging.aptrust.org<ul> <li>Staging is for very new, potentially unstable features.</li> <li>Staging is currently the only system that accepts Beyond the Repository (BTR) formatted bags.</li> <li>Staging does not preserve anything for more than 7 days.</li> </ul> </li> <li>Test/Demo Repository - https://demo.aptrust.org<ul> <li>Demo is for you to test your bagging process and for APTrust to test new features that are considered stable.</li> <li>Demo does not guarantee preservation of anything beyond a few days.</li> </ul> </li> <li>Production Repository - https://repo.aptrust.org<ul> <li>Production is for materials you want to preserve for the long term.</li> </ul> </li> </ul>"},{"location":"quick_start/#adding-users","title":"Adding Users","text":"<p>See the User Management page for info on how to add users to your institution's Registry account.</p>"},{"location":"quick_start/#making-your-first-deposit","title":"Making Your First Deposit","text":"<p>We suggest you make your first deposits in the demo repository, so you can test out your workflows and get a feel for how Registry works.</p>"},{"location":"quick_start/#depositing-with-dart","title":"Depositing with DART","text":"<p>The easiest way to make your first APTrust deposit is to use DART, which enables drag-and-drop deposits.</p> <p>DART runs on Windows, Mac, and Linux. To install DART and run your first ingest job, see the DART user guide.</p> <p>DART allows you to test test out different bagging and uploading options through a simple point-and-click interface. Once you find the combination that works for you, you can save it as a Workflow, and then you can run that workflow from within DART, or from the command line. You can also incorporate DART's command-line workflows into larger scripted workflows using languages like Ruby, Python, PHP, JavaScript or even bash shell scripts.</p>"},{"location":"quick_start/#exporting-from-fedora","title":"Exporting from Fedora","text":"<p>If your local repository uses Fedora, you can export APTrust-compliant bags directly from Fedora and then upload them to your receiving bucket for ingest.</p> <p>After Fedora produces the bag, you can use APTrust apt_upload tool to upload the bag to your receiving bucket. From there, APTrust ingest services will pick it up for processing, and you can track its progress in the Registry Work Items list.</p>"},{"location":"quick_start/#custom-bagging","title":"Custom Bagging","text":"<p>If you want to bag materials yourself, be sure your bags conform to the APTrust bagging requirements. After bagging, you can use APTrust's apt_upload tool or other publicly available tools such as the MinIO client to upload your bag.</p>"},{"location":"quick_start/#rest-api-integration","title":"REST API Integration","text":"<p>If you're interested in automating deposits, restorations and other preservation activities, see our REST API and Swagger Docs</p>"},{"location":"bagging/","title":"APTrust Bagging Requirements","text":"<p>APTrust currently accepts bags for ingest that use the APTrust BagIt and Beyond the Repository (BTR) BagIt profiles. Bags will be restored using the same profile as the submission.</p> <p>For info on what constitutes a valid BTR bag, see version 1.0 of the BTR bagit profile.</p> <p>The remainder of this page will discuss the APTrust format and the allowed options to use when bagging.</p> <p>Note</p> <p>When you upload a bag to APTrust, ingest services will look at the BagIt-Profile-Identifier tag in the bag-info.txt file. If this is set to https://github.com/dpscollaborative/btr_bagit_profile/blob/1.0/btr-bagit-profile.json, it will be validated according to the BTR BagIt profile.</p> <p>If BagIt-Profile-Identifier is set to any other value, or if the value is missing, ingest services will validate the bag according to the APTrust profile.</p>"},{"location":"bagging/#aptrust-bagit-specification","title":"APTrust BagIt Specification","text":"<p>In addition to conforming to the BagIt specification version 0.97 or version 1.0, valid APTrust bags must include the tag files and tags listed below, and must meet the following criteria:</p> <ul> <li> <p>Bags must be serialized in tar format.</p> </li> <li> <p>Tarred bags must untar to a single directory whose name matches the name of the tar file. For example, <code>my_bag.tar</code> must untar to a directory called <code>my_bag</code>.</p> </li> <li> <p>The name of the tarred bag file must not include directories. <code>my.edu.my_bag.tar</code> is valid. <code>C:\\path\\to\\my.edu.my_bag.tar</code> is not.</p> </li> <li> <p>Bags must contain an md5 manifest and may also contain a sha256 manifest.</p> </li> <li> <p>Bags must be 5 terabytes or less in size.</p> </li> <li> <p>Bags may not contain a fetch.txt file.</p> </li> <li> <p>Bags may contain tag manifests.</p> </li> <li> <p>Bags may contain files outside of the data directory other than manifests and tag manifests. APTrust will consider these to be tag files, and will not try to parse them.</p> </li> <li> <p>When uploading multipart bags, use Bag-Group-Identifier tag to indicate that the bags belong together, or use the multipart bag naming format described below. (But note that the multipart bag naming format will soon be deprecated.)</p> </li> </ul> <p>A valid untarred APTrust bag has the following structure:</p> <pre><code>           &lt;base directory&gt;/\n           |   aptrust-info.txt\n           |   bag-info.txt\n           |   bagit.txt\n           |   manifest-&amp;lt;algorithm&amp;gt;.txt (md5 AND/OR sha256)\n           |   [optional tag manifests]\n           |   [optional additional tag files]\n           \\--- data/\n                 |   [payload files]\n           \\--- [optional tag directories]/\n                 |   [optional tag files]\n</code></pre>"},{"location":"bagging/#file-and-directory-names","title":"File and Directory Names","text":"<ul> <li>File and Folder names must follow POSIX conventions:</li> <li>Contain upper or lower case letters, numbers, dots, underscores, percent signs, or dashes. (A\u2013Z a\u2013z 0\u20139 . _% -)</li> <li>May contain virtually any printable character, except newlines, carriage returns, tabs, vertical tabs and ASCII bells. (As of 1/30/2017)</li> <li>Are considered case sensitive.</li> <li>MUST not begin with a dash. (-)</li> <li>MUST not contain whitespaces</li> <li>May contain whitespaces. (As of 1/30/2017)</li> <li>Restricted to 255 characters in length including extension.</li> <li>MUST be at least 1 character in length.</li> </ul>"},{"location":"bagging/#bagittxt-file","title":"bagit.txt file","text":"<p>The bag must have a bagit.txt file, with the following tags.</p> Tag Allowed values BagIt-Version 0.97 or 1.0 Tag-File-Character-Encoding UTF-8"},{"location":"bagging/#bag-infotxt-file","title":"bag-info.txt file","text":"<p>The bag-info.txt file should contain the following tags:</p> Tag Description Example Source-Organization This should be the human readable name of the APTrust partner organization. For example, \"University of Virginia.\" You may be more specific, if you wish, specifying a specific college or library within the university, such as \"Georgetown University Law Library.\" However, when APTrust restores bags, the source organization in the bag-info.txt file will be set to the name of the partner institution. University of Virginia Bagging-Date The date the content was bagged. Use ISO 8601 UTC format (YYYY-MM-DD). 2019-08-19 Bag-Count Two numbers separated by \"of\", in particular, \"N of T\", where T is the total number of bags in a group of bags and N is the ordinal number within the group; if T is not known, specify it as \"?\" (question mark). Examples: 1 of 2, 4 of 4, 3 of ?, 89 of 145. Internal-Sender-Description A sender-local explanation of the contents and provenance. Internal-Sender-Identifier An alternate sender-specific identifier for the content and/or bag. Bag-Group-Identifier A sender-supplied identifier for the set, if any, of bags to which it logically belongs. Greeling Photo Collection <p>For more on bag group identifiers, see the Bag Group Identifiers section of the Objects page.</p> <p>For a list of other commonly-used tags in the bag-info.txt file, see the official BagIt specification for version 0.97 or version 1.0.</p> <p>APTrust supports all of the tags mentioned in the 0.97 and 1.0 specifications. You may also add your own custom tags to this file.</p>"},{"location":"bagging/#aptrust-infotxt-file","title":"aptrust-info.txt file","text":"<p>This file must contain the following tags:</p> Tag Description Title A human readable title for searching and listing in APTrust. This cannot be empty. Description A human-readable description of the bag. This will appear in Registry. Access One of three access options listed below. The access option describes who can see an object's metadata, including its name and description, a list of its generic files and events. APTrust does not currently provide access to the objects themselves, except when you restore one of your bags. No matter which access option you choose, no other institution can access your intellectual object. Storage-Option This indicates how and where you want APTrust to store your bag. If omitted, Storage-Option defaults to \"Standard\". See the section on Storage Options below for more information."},{"location":"bagging/#allowed-storage-option-values","title":"Allowed Storage-Option Values","text":"<ul> <li> <p>Standard: The bag's contents will be store in S3 in Northern Virginia and Glacier in Oregon. APTrust will perform fixity checks on the S3 files every 90 days.</p> </li> <li> <p>Glacier-OH: Files will be stored ONLY in Glacier, in AWS's Ohio region, and will be encrypted during storage. APTrust will not perform any fixity checks on these files.</p> </li> <li> <p>Glacier-OR: Files will be stored ONLY in Glacier, in AWS's Oregon region, and will be encrypted during storage. APTrust will not perform any fixity checks on these files.</p> </li> <li> <p>Glacier-VA: Files will be stored ONLY in Glacier, in AWS's Northern Virginia region, and will be encrypted during storage. APTrust will not perform any fixity checks on these files.</p> </li> <li> <p>Glacier-Deep-OH: Files will be stored ONLY in Glacier Deep Archive, in AWS's Ohio region, and will be encrypted during storage. APTrust will not perform any fixity checks on these files.</p> </li> <li> <p>Glacier-Deep-OR: Files will be stored ONLY in Glacier Deep Archive, in AWS's Oregon region, and will be encrypted during storage. APTrust will not perform any fixity checks on these files.</p> </li> <li> <p>Glacier-Deep-VA: Files will be stored ONLY in Glacier Deep Archive, in AWS's Northern Virginia region, and will be encrypted during storage. APTrust will not perform any fixity checks on these files.</p> </li> <li> <p>Wasabi-OR: Files will be stored only in Wasabi's Oregon data center. These files will receive fixity checks every 90 days.</p> </li> <li> <p>Wasabi-VA: Files will be stored only in Wasabi's Virginia data center. These files will receive fixity checks every 90 days.</p> </li> </ul> <p>A note on storage options</p> <p>When you update an existing bag, APTrust will apply Storage-Option of the original version to the new version, even if the new version's Storage-Option tag explicitly specifies something different. This is to prevent the proliferation of multiple different versions of an object across multiple storage areas. If you want to change the Storage-Option of an existing object, you must delete it and then re-ingest it with the new option.</p>"},{"location":"bagging/#storage-options-and-fixity-checks","title":"Storage Options and Fixity Checks","text":"<p>As noted in the list of storage options above, we check fixity only on items in S3 and Wasabi storage, not on items in Glacier and Glacier Deep Archive. If you want APTrust to run regular fixity checks on your materials, choose the Standard, Wasabi-OR or Wasabi-VA storage options.</p>"},{"location":"bagging/#allowed-access-values","title":"Allowed Access Values","text":"<ul> <li> <p>Restricted: Metadata about this object is accessible to the institutional administrator (at the depositing institution) and to the APTrust admin. No one else can even see that this object exists in the repository.</p> </li> <li> <p>Institution: All users at the depositing institution can see metadata about this object.</p> </li> <li> <p>Consortia: All APTrust members can see this object's metadata. DEPRECATED. Consortial access was never implemented in the APTrust repository. Use Restricted or Institution instead. The Consortia access option is treated the same as the Institution access option.</p> </li> </ul>"},{"location":"bagging/#multipart-bags-deprecated","title":"Multipart bags - DEPRECATED","text":"<p>Deprecation Notice</p> <p>APTrust will soon end support for the multipart naming format described in this section. Use the standard Bag-Group-Identifier tag instead, as described in the following section.</p> <p>You may split a single large bag into a number of smaller bags by using the naming convention <code>institution_identifier.bag_identifier.b###.of###</code>. That is, you append <code>.bag01.of16</code>, <code>.bag02.of16</code>, etc. to the end of the bag name of each bag in the group.</p> <p>Upon ingest, APTrust will treat all of the contents of all of the bags as part of a single intellectual object. Thus, the contents of <code>test.edu/photos.bag01.of03.tar</code>, <code>test.edu/photos.bag02.of03.tar</code>, and <code>test.edu/photos.bag03.of03.tar</code> would all be collected into a single intellectual object called <code>test.edu/photos</code>.</p> <p>Because APTrust re-bags files for restoration, the bags returned by a restoration request will not match the bags you originally submitted, but all of the payload files will be present.</p> <p>Generic Files in APTrust are referenced by their URI, which is the original filepath relative to the bag. File and folder names should be unique across multi-part bags to make sure all items are processed and not treated as a file update.</p>"},{"location":"bagging/#multipart-bags-the-new-way","title":"Multipart bags - THE NEW WAY","text":"<p>Please use the Bag-Group-Identifier tag in the bag-info.txt file to indicate that multiple bags are part of the same group. Bag-Group-Identifier is part of the BagIt standard described in RFC 8493. The specification defines a Bag-Group-Identifier as <code>A sender-supplied identifier for the set, if any, of bags to which it logically belongs.</code></p> <p>Registry supports searching by Bag-Group-Identifier, which makes it easy for you to see which bags and files belong to the same logical group.</p> <p>The Bag-Group-Identifier tag provides the additional advantage of allowing you to restore specific parts of a collection without having to restore the entire collection. Under the old multipart naming scheme, all bag parts would be merged into a single giant bag. Bags sharing a Bag-Group-Identifier remain distinct intellectual objects and can be restored individually.</p>"},{"location":"bagging/#versioning","title":"Versioning","text":"<p>APTrust does not currently support versioning. When you upload new versions of existing files, APTrust overwrites the old version with the new. See Updates for details.</p> <p>If you want to keep multiple versions of a bag or file, append a version number or timestamp to the end of the bag or file name. For example, <code>test.edu/bag_of_photos</code> and <code>test.edu/bag_of_photos.v2</code> will be stored as separate objects, and files from the second version will not overwrite files from the first.</p>"},{"location":"bagging/#bagging-empty-folders","title":"Bagging Empty Folders","text":"<p>APTrust cannot preserve or restore empty folders. If you want to include an empty folder in your bag, add an empty file to it, and we will preserve it. We recommend creating an empty file called <code>.keep</code>. The leading period in the filename ensures that it will be hidden from most file browsers, making the directory appear empty. The name <code>.keep</code> is traditionally used to indicate that the folder, although empty, should be preserved.</p>"},{"location":"bagging/tools/","title":"Bagging Tools","text":""},{"location":"bagging/tools/#dart","title":"DART","text":"<p>DART provides both a graphical UI and a command-line interface for building bags and uploading them to APTrust. If you're in a hurry, DART is the best way to get started. If you want to build an APTrust ingest workflow through a point-and-click interface and later incorporate that workflow into a set of scripted tasks, DART is also a good choice, as it supports both graphical and comman-line use.</p> <p></p>"},{"location":"bagging/tools/#partner-tools","title":"Partner Tools","text":"<p>See the Partner Tools section of this guide for info on creating and validating bags with our new partner tools.</p>"},{"location":"bagging/tools/#python-bagit","title":"Python BagIt","text":"<p>If you want to roll your own bagger, try the Library of Congress's bagit.py module, or create a variation of the work already started by the University of Miami or North Carolina State University.</p> <ul> <li>BagIt Python</li> <li>Miami's APTrust-specific bagit scripts</li> <li>NCSU's APTrust-specific bagit scripts</li> </ul>"},{"location":"preservation/deletion/","title":"Deletion","text":""},{"location":"preservation/deletion/#the-deletion-process","title":"The Deletion Process","text":"<p>Deleting objects from APTrust is a multi-step process.</p> <ol> <li> <p>An institutional administrator requests deletion of a file or entire object by clicking the delete button in Registry (see below). Note that only institutional administrators can request deletions.</p> </li> <li> <p>APTrust generates an email to other administrators at the same institution asking them to confirm the deletion.  (If your institution has only one admin, APTrust will send the confirmation email to that admin.)</p> </li> <li> <p>If one additional admin clicks the 'confirm deletion' link in the email, the files or objects will be deleted.</p> </li> </ol>"},{"location":"preservation/deletion/#minimum-retention-period","title":"Minimum Retention Period","text":"<p>Files and objects stored in S3 or in APTrust's Standard storage option (which includes both S3 and Glacier) can be deleted at any time.</p> <p>Items stored in Glacier, Glacier Deep Archive and Wasabi cannot be deleted until they have been stored for  the minimum retention period. Minimum retention periods are:</p> <ul> <li>Glacier 90 days</li> <li>Glacier Deep Archive 180 days</li> <li>Wasabi 90 days</li> </ul> <p>For files and objects that have not met the minimum retention period, Registry's Delete button will be disabled. Hovering over the button will display a message describing why the item can't be deleted and the date it will become eligible for deletion.</p> <p>Minimum retention periods do not apply to file and object updates. You can update files and objects at any time after ingest, regardless of storage option and minimum retention periods. </p>"},{"location":"preservation/deletion/#deleting-an-intellectual-object","title":"Deleting an Intellectual Object","text":"<p>The screenshot below shows the detail page for an intellectual object. Clicking the Delete button on this page initiates the deletion process for the entire object.</p> <p></p>"},{"location":"preservation/deletion/#deleting-a-single-file","title":"Deleting a Single File","text":"<p>You can delete individual files from the Intellectual Object page or from the Generic File Detail page. To delete from the Intellectual Object page:</p> <ol> <li>Locate the file you want to delete. If you don't see it in the list of files below the donut charts, you can search for it by identifier or you can click one of the arrows below the list to load another page of file results.</li> <li>Click the plus sign next to the file you want to delete. This opens the file detail view.</li> <li>Scroll down to the end of the shaded file detail view and click the Delete File button.</li> </ol> <p></p> <p>You can also delete files from the file detail page. To do so:</p> <ol> <li>Click More Options in the left nav.</li> <li>Click Files.</li> <li>Enter the file identifier in the search box and click Filter.</li> <li>Click on the file you want to delete. This will open the file detail view.</li> <li>Scroll to the bottom of the page and click Delete.</li> </ol> <p></p>"},{"location":"preservation/deletion/#deletion-requests","title":"Deletion Requests","text":"<p>After clicking the Delete button, the system will create a deletion request record and send emails to other administrators at your insitution asking them to approve or reject the deletion request. The deletion emails contain a link and a special token to access the deletion request.</p> <p>The administrator follows the link, enters the token, then chooses whether to approve or reject the request. Note that even if an unauthorized user gets hold of the token in the email, they won't be able to approve or reject the request unless they are an admin at your institution.</p> <p>If the admin rejects the deletion request, the process ends there, and Registry takes no further action.</p> <p>If the admin approves the request, the Registry creates a Deletion Work Item and hands it off to Preservation Services to fulfill.</p>"},{"location":"preservation/deletion/#deletion-work-items","title":"Deletion Work Items","text":"<p>After an institutional administrator confirms a deletion, the deletion request will appear in the list of work items, where you can track its progress. Deleting a single file or a single object results in one work item.</p> <p>The image below shows a list of completed work items. Note that deletions usually happen fairly quickly, within minutes of your institutional admin's confirmation of the deletion request email.</p> <p></p>"},{"location":"preservation/deletion/#deletion-request-records","title":"Deletion Request Records","text":"<p>You can view a list of all requested deletions* from your institution by clicking More Options in the left nav bar, then clicking Deletions. Click on any item in the list to see when the deletion was requested, and by whom. You'll also see who approved or rejected it, the file or object to be deleted, and (if the deletion was approved) the associated Work Item.</p>"},{"location":"preservation/deletion/#effect-of-deletion-on-metadata","title":"Effect of Deletion on Metadata","text":"<p>When you delete a file, Registry creates a deletion PREMIS event for the file that includes the date and time of deletion and the email address of the user who requested the deletion. Registry keeps the generic file records, changing it's state from 'Active' to 'Deleted.' Registry also keeps all prior PREMIS events and fixity records related to the file, and the file record remains accessible through both the Web UI and the member API. In addition, Registry keeps a Work Item record that shows when the deletion was requested and when it was completed. Work Items are also available through the Web UI and the member API.</p>"},{"location":"preservation/deletion/#bulk-deletion","title":"Bulk Deletion","text":"<p>Contact help@aptrust.org if you want to delete a large number of objects. For bulk deletions, the depositor sends us a list of items to delete and APTrust initiates the process.</p> <p>Your institutional admins will still have to confirm the deletions before we execute them, but the process can save you having to click on the delete button on a large number of object or file detail pages.</p>"},{"location":"preservation/deletion/#reingest-after-deletion","title":"Reingest After Deletion","text":"<p>If you delete an object and then upload a new version, Registry will mark the deleted object as active again and will create a new ingest event. The new object will include all of the files in the newly uploaded bag. If any of the newly uploaded files have the same identifier as a deleted file, Registry will mark the previously deleted file as active again, and will record the new version's checksums along with a new ingest event.</p> <p>In short, it's safe to delete an object and then re-upload it.</p>"},{"location":"preservation/ingest/","title":"Ingest","text":"<p>Notice</p> <p>Before sending materials to APTrust for ingest, you'll need to get AWS keys that allow you to upload materials to your receiving bucket. If you don't already have these, contact help@aptrust.org to get them. Also keep in mind that you'll have separate AWS keys for the demo and production environments.</p> <p>You'll also need to know how to produce a valid APTrust bag. If you don't know how to do that yet, see the bagging page for details, or use DART to get going quickly.</p>"},{"location":"preservation/ingest/#uploading-for-ingest","title":"Uploading for Ingest","text":"<p>Assuming you have a valid bag, you can send it to our production system by uploading it to <code>aptrust.receiving.test.&lt;institution.domain&gt;</code> for the demo system or <code>aptrust.receiving.&lt;institution.domain&gt;</code> for the production system. In each case, replace <code>&lt;institution.domain&gt;</code> with your institution's domain name.</p> <p>The following tools can upload files to your receiving bucket:</p> <ul> <li>DART</li> <li>APTrust Partner Tools</li> <li>Minio Client</li> <li>Amazon's AWS Command Line Tools</li> </ul> <p>If you plan on interacting frequently with S3, the Minio Client provides the best combination of rich features, ease of installation, and ease of use.</p> <p>For most of what you'll be doing with APTrust, DART and the APTrust Partner Tools should be sufficient.</p>"},{"location":"preservation/ingest/#the-ingest-process","title":"The Ingest Process","text":"<p>Warning</p> <p>There can be a delay of up to 15 minutes before the tarred bag shows up in the work item list.</p> <p>After you upload tarred bag to your receiving bucket, APTrust's ingest process will add it to a list of items waiting to be processed.  You can check the status of your bag in the list of Registry Work Items, using the REST API, or using the apt_check_ingest program from the partner tools. Once your bag is successfully ingested it is automatically deleted from your receiving bucket. If the ingest fails you can see details in Registry.</p> <p>Notice</p> <p>Failed bags stay in your receiving bucket for 30 or 60 days (demo or production) for your review. After that period the bag is automatically deleted.</p> <p></p> <p>DART's dashboard also shows the status of items recently ingested and pending ingest.</p> <p>Smaller bags (those under about 5GB) tend to ingest quickly. Larger bags can take longer, with multi-terabyte bags sometimes taking a few days. This is because the ingest process calculates checksums on every byte of data in the bag and then typically copies each of the bag's files to two distinct regions of the country.</p>"},{"location":"preservation/ingest/#ingest-restrictions","title":"Ingest Restrictions","text":"<ul> <li>Materials must be sent in tarred bags.</li> <li>Bag names, and the names of files within bags, may not include control characters (such as backspace, delete, etc.)</li> <li>Maximum bag size on our demo system is 5 GB</li> <li>Maximum bag size on our production system is 5 TB</li> </ul> <p>You can get around the 5TB bag size limit by using bag groups and the Bag-Group-Identifier tag. See the bagging page for more info.</p>"},{"location":"preservation/ingest/#reingesting-existing-bags","title":"Reingesting Existing Bags","text":"<p>You can re-upload a bag any time you like to your receiving bucket, but be sure to read the page on updates so you understand how APTrust processes bag updates.</p>"},{"location":"preservation/restoration/","title":"Restoration","text":""},{"location":"preservation/restoration/#restoring-intellectual-objects","title":"Restoring Intellectual Objects","text":"<p>You can restore an intellectual object by navigating to the object detail page and clicking the Restore button.</p> <p>You can find an object by going to the Object List page, clicking More Filters, and typing its identifier into the identifier search field.</p> <p></p> <p>When you reach the object detail page, click the blue Restore button in the upper right corner of the page.</p> <p></p> <p>After you click Restore Object, APTrust does the following:</p> <ol> <li> <p>Creates a work item describing what is to be restored.</p> </li> <li> <p>Copies all of the object's files into a new bag, verifying each file's checksums in the process.</p> </li> <li> <p>Copies the latest version of the aptrust-info.txt and bag-info.txt files into the bag.</p> </li> <li> <p>Writes a JSON file into the bag containing all of the PREMIS events APTrust recorded for that bag and its contents.</p> </li> <li> <p>Adds md5 and sha256 manifests and tag manifests to the bag.</p> </li> <li> <p>Copies the bag to your restoration bucket at <code>aptrust.restore.&lt;your.domain&gt;</code> in our production repo, or <code>aptrust.restore.test.&lt;your.domain&gt;</code> in our demo repo.</p> </li> <li> <p>Marks the work item as complete.</p> </li> </ol>"},{"location":"preservation/restoration/#notes-on-restored-bags","title":"Notes on Restored Bags","text":"<p>Because we rebuild bags for restoration, the bag you get back will not exactly match the bag you deposited, though we do guarantee that it contains all of the latest versions of all of the payload files.</p> <p>If you submitted a bag that was packaged according to the BTR BagIt Profile, it will restored in BTR format. All other bags will be restored in APTrust format.</p> <p>Note that, in addition to payload files, we preserve and restore the following tag files:</p> <ul> <li>aptrust-info.txt</li> <li>bag-info.txt (Which will be modified on restoration. See below.)</li> <li>Any other file outside the original bag's data directory that is not a manifest, tag manifest or fetch.txt file.</li> </ul> <p>We preserve the files above because they often contain important metadata.</p> <p>Restored bags tend to differ in the following ways from your originally submitted bags:</p> <ul> <li> <p>Restored APTrust bags have both sha256 and md5 manifests, while the bag you originally deposited typically has only one or the other.</p> </li> <li> <p>Restored APTrust bags include md5 and sha256 tag manifests while bags submitted for ingest typically have neither.</p> </li> <li> <p>Restored BTR bags include sha1, sha256, and sha512 manifests and tag manifests, even if the original bag included only one of these.</p> </li> <li> <p>Restored bags include a modified bag-info.txt file. The modified file will include all of the tags and values included in the last ingested version of the bag, but:</p> <ul> <li>The bag will have a new Payload-Oxum.</li> <li>The original Payload-Oxum will be included as Original-Payload-Oxum.</li> <li>The bag will have a new Bagging-Date describing when APTrust's bag restorer rebuilt the bag.</li> <li>The original Bagging-Date will be included as Original-Bagging-Date.</li> <li>The bag will have a new Bag-Size describing the size of the restored bag.</li> <li>The original Bag-Size will be included as Original-Bag-Size.</li> <li>The bag will have a new Bagging-Software value saying that the bag was created by the APTrust restorer.</li> <li>The original Bagging-Software name will included as Original-Bagging-Software.</li> </ul> </li> <li> <p>Restored bags include the latest version of each preserved file in the payload (data) directory.</p> </li> </ul> <p>This last point is important. In some cases, you or someone at your institution may have deleted files from a bag, or uploaded newer versions of files in a bag after the bag was initially ingested. Deleted files cannot be restored, and the restored bag will always contain the last uploaded version of each file.</p> <p>You can find information about updated and deleted files in the APTrust registry.</p> <ol> <li>Go to https://repo.aptrust.org/objects</li> <li>Search for the object you want to investigate. The easiest way to find an object is by its identifier.</li> <li>Scroll down the object detail page to the list of Active Files.</li> <li>Click the plus sign next to a file record to see its checksum history. If a newer version of a file was uploaded after initial ingest, this view will show you the old and new checksums, and the dates on which the checksum changed. You'll find more info, including a full list of Premis events, on the file detail page. Go to https://repo.aptrust.org/files and enter paste in the file identifier.</li> <li>To see a list of files deleted from the current object, click the show deleted files link on the top right side of the Active Files list.</li> </ol> <p>Because files may have been added to or deleted from a bag after its initial ingest, the Bag-Size and Payload-Oxum of the restored bag may differ from the Bag-Size and Payload-Oxum of any individual ingests. This is why we include both the current and original values in the restored version.</p> <p>If you're curious about why the contents of a restored bag differ from the original, the object's PREMIS events should provide a detailed record of all additions and deletions. See PREMIS Events for more info.</p>"},{"location":"preservation/restoration/#restoring-individual-files","title":"Restoring Individual Files","text":"<p>You can restore individual files from the Intellectual Object page or from the Generic File Detail page. To restore from the Intellectual Object page:</p> <ol> <li>Locate the file you want to restore. If you don't see it in the list of files below the donut charts, you can search for it by identifier or you can click one of the arrows below the list to load another page of file results.</li> <li>Click the plus sign next to the file you want to restore. This opens the file detail view.</li> <li>Scroll down to the end of the shaded file detail view and click the Restore File button.</li> </ol> <p></p> <p>You can also restore files from the file detail page. To do so:</p> <ol> <li>Click More Options in the left nav.</li> <li>Click Files.</li> <li>Enter the file identifier in the search box and click Filter.</li> <li>Click on the file you want to restore. This will open the file detail view.</li> <li>Scroll to the bottom of the page and click Restore.</li> </ol> <p></p> <p>APTrust performs the following steps for file restoration:</p> <ol> <li> <p>Creates a work item with the restoration request.</p> </li> <li> <p>Verifies the file's checksum.</p> </li> <li> <p>Copies the file to your receiving bucket at <code>aptrust.restore.&lt;your.domain&gt;</code> in our production repo, or <code>aptrust.restore.test.&lt;your.domain&gt;</code> in our demo repo.</p> </li> <li> <p>Marks the work item as complete.</p> </li> </ol>"},{"location":"preservation/restoration/#restoration-timeline","title":"Restoration Timeline","text":"<p>Restoring an item usually takes anywhere from 10 minutes to 24 hours, depending on the size of the object, where it is stored, and the number of work items the system has to process before it gets to yours.</p> <ul> <li> <p>When restoring items from S3, the restoration process can usually begin immediately, since the files are immediately accessible. For items using Standard storage (as opposed to Glacier-Only), APTrust always restores from S3.</p> </li> <li> <p>Restoring from Glacier takes longer than restoring from S3.</p> <ul> <li>When restoring from Glacier-only storage, it takes 4-5 hours to move files to a place where APTrust can copy and validate them.</li> <li>When restoring from Glacier Deep Archive, it takes 12 hours to move files into a location where APTrust can copy and validate them.</li> </ul> </li> <li> <p>The size of the items being restored determines how long it will take to restore them. For example, a 1 MB file can often be restored in under a minute. A 1 TB bag may take 24 hours or more. Most of restoration time is taken up by copying the files and validating their md5 and sha256 checksums.</p> </li> <li> <p>You can calculate overall restoration time as:</p> <ul> <li>S3: A product of file size: A few minutes for a few megabytes, or several hours for objects and files over 100 GB.</li> <li>Glacier: 4-5 hours plus file size.</li> <li>Glacier Deep Archive: 12 hours plus file size.</li> </ul> </li> </ul>"},{"location":"preservation/restoration/#monitoring-restoration-progress","title":"Monitoring Restoration Progress","text":"<p>You can check the progress of your restoration requests in Registry' Work Items list or the Registry REST API.</p> <p></p> <p>When a restoration is complete, the file or bag will be waiting in your restoration bucket and APTrust will send an email to your institutional admins. The email includes information about the location of the restored file so you can download it.</p> <p>Downloading Restored Items</p> <p>You can use the apt_download command from our Partner Tools to download restored bags.</p> <p>Restored items are automatically deleted from your restoration bucket after 14 days to avoid ongoing storage costs. (We do not delete the preservation copy, only the copy in your restoration bucket.)</p>"},{"location":"preservation/updates/","title":"Updates","text":"<p>APTrust does not version bags. If you want to keep multiple versions of a bag, use a naming convention. For example: <code>virginia.edu.bag_of_photos</code>, <code>virginia.edu.bag_of_photos_V2</code>, <code>virginia.edu.bag_of_photos_V3</code>.</p> <p>When you upload a bag that has the same name as an existing bag, this is what happens:</p> <ol> <li> <p>If a file in the new bag has the same name as a file in the old bag and the size or the md5 checksum or the sha256 checksum has changed, we overwrite the old file with the new one. You cannot recover the old file.</p> </li> <li> <p>If a file in the new bag has the same name as a file in the old bag and the size and checksums have not changed, we do nothing.</p> </li> <li> <p>If a file in the new bag did not exist in the old bag, we save it, but if a file in the old bag is not present in the new bag, we do not delete it.</p> </li> </ol> <p>The table below shows what happens when you upload a new version of a previously ingested bag.</p> Old Bag New Bag What we preserve Why bag-info.txt bag-info.txt (changed) the new version Contents in new version have changed data/document.pdf data/document.pdf (unchanged) old version The document did not change (file not present) data/new_image.jpg new version File did not exist in old bag, but it's here now data/old_image.jpg (file not present) old version Although this file has been deleted from the new bag, we will not assume you want to delete it from storage. File deletion must be a deliberate act of the depositor. <p>This update policy has three important implications:</p> <ol> <li> <p>If you want to delete files from an ingested bag / intellectual object, you must do that deliberately. Currently, you can delete only through our Web UI.</p> </li> <li> <p>When you restore the bag described in the table above, you'll get back both old_image.jpg and new_image.jpg (unless you manually delete one of them before you restore).</p> </li> <li> <p>You can update metadata in a bag by uploading only the metadata, as long as there's at least one file in the data directory and the bag is otherwise valid. This may be useful for bags that contain 100GB of data and 100KB of frequently-updated metadata.</p> </li> </ol> <p>In Registry, updating (overwriting) an existing file in a bag causes the following to happen:</p> <ol> <li> <p>A new PREMIS ingestion event appears with the date of the new ingest.</p> </li> <li> <p>Two new PREMIS fixity generation events appear, one with the md5 checksum of the new file, and one with the sha256 checksum.</p> </li> </ol> <p>The Registry file page for the updated file will show the new checksums for the file at the bottom of the page, along with the date on which the new checksums were calculated. Below those will be the older checksums, and the dates they were calculated.</p> <p>Future fixity checks on the updated files will test against the latest fixity value of the updated files.</p>"},{"location":"registry/","title":"Using Registry","text":""},{"location":"registry/#logging-in","title":"Logging In","text":"<p>If you don't already have a Registry account, contact the APTrust administrator at your organization to set one up.</p> <p>If your organization does not yet have an account, contact help@aptrust.org to get set up.</p> <p>Once you have an account, log in with your email address to either the demo system or the production system.</p> <ul> <li> <p>Demo: https://demo.aptrust.org</p> </li> <li> <p>Production: https://repo.aptrust.org</p> </li> </ul> <p>You'll be asked to change your password the first time you log in. Depending on your organization's security settings, you may also be asked to activate two-factor authentication. For more on that, see Two Factor Authentication.</p> <p>Note that because the demo and production systems are separate, you will have to reset your password on each system the first time you log in. You can have different passwords and different two-factor authentication settings for each system.</p>"},{"location":"registry/#forgot-your-password","title":"Forgot Your Password?","text":"<p>If you forget your password, go to the appropriate login page above (Demo or Production) and click the Forgot your password? link below the Sign In button. The system will email you instructions on how to proceed.</p> <p></p>"},{"location":"registry/api_changes/","title":"API Changes from Pharos","text":"<p>The primary API changes from Pharos to Registry include:</p> <ul> <li>Change in endpoint prefix from /member-api/v2/ to /member-api/v3/</li> <li>Use of numeric IDs in URLs instead of object and file identifiers.</li> <li>Changes to some filter and sort parameters in endpoints that return lists of records. Registry includes more filter and sort options than Pharos.</li> <li>Minor changes to JSON structure of responses. Registry generally returns richer data that is easier to understand.</li> </ul>"},{"location":"registry/api_changes/#using-ids-instead-of-identifiers","title":"Using IDs Instead of Identifiers","text":"<p>The change from identifiers to IDs deserves special mention. In the Pharos REST API, you would request file information with a URL like this:</p> <p><code>GET /member-api/v2/files/test.edu/my-object/data/my-file.pdf</code></p> <p>The corresponding request in the Registry API looks like this:</p> <p><code>GET /member-api/v3/files/21145</code></p> <p>The reason for this change is that file identifiers contain slashes, just like URL path identifiers. They also often contain characters that are illegal in URLs and require special encoding. In addition, Pharos URLs could contain query strings after the embedded file identifer.</p> <p>In practice, URLs with long, messy file names followed by query strings became nearly impossible to parse. The pattern for extracting embedded file identifiers from URLs became unmaintainable, and still cannot match a number of identifiers in our system.</p> <p>This change creates a problem. Object and file identifiers are semantic and knowable to depositors. Numeric IDs are opaque and unknowable. So how can you can map the known to the unknown?</p> <p>Easy. These requests will return object and file records that include IDs:</p> <p><code>GET /member-api/v3/objects?identifier={object-identifier}</code></p> <p><code>GET /member-api/v3/files?identifier={file-identifier}</code></p>"},{"location":"registry/api_changes/#list-structure","title":"List Structure","text":"<p>For endpoints returning lists of records (object, files, events, etc.), Pharos returned this format:</p> <pre><code>{\n   count: integer,\n   next: string (url),\n   previous: string (url),\n   results: array of objects\n}\n</code></pre> <p>Registry returns this format. The only difference is that <code>results</code> is now <code>items</code>:</p> <pre><code>{\n   count: integer,\n   next: string (url),\n   previous: string (url),\n   items: array of objects\n}\n</code></pre> <p>Changes in item structure are described below.</p>"},{"location":"registry/api_changes/#query-parameter-changes","title":"Query Parameter Changes","text":"<p>Endpoints returning lists support more sorting and filtering parameters than their Pharos counterparts. While the exact parameters for each endpoint are listed in the Registry Swagger docs, you should note the following patterns.</p>"},{"location":"registry/api_changes/#sorting","title":"Sorting","text":"<p>Sorting parameter names use the pattern {field_name}__{direction}, with two underscores before direction. If no direction is specified, it defaults to <code>asc</code>.</p> <p>Examples:</p> <ul> <li><code>intellectual_object_identifier</code> - Sort by intellectual object identifier, ascending.</li> <li><code>intellectual_object_identifier__asc</code> - Sort by intellectual object identifier, ascending.</li> <li><code>intellectual_object_identifier__desc</code> - Sort by intellectual object identifier, descending.</li> </ul>"},{"location":"registry/api_changes/#filtering","title":"Filtering","text":"<p>Filtering parameter names generally match JSON field names. For example, to get a list of files or objects stored in Standard storage, add the following to your query string:</p> <p><code>storage_option=Standard</code></p> <p>For datetime and numeric fields, append <code>__gteq</code> or <code>__lteq</code> to the field name to find items whose field value is \"greater than or equal to\" (gteq) or \"less than or equal to\" (lteq) the specified value. Note the double unscore before each suffix.</p> <p>Examples:</p> <ul> <li><code>created_at__gteq=2022-08-01&amp;created_at__lteq=2022-08-31</code> returns records created between August 1, 2022 and August 31, 2022.</li> <li><code>size__gteq=1000</code> returns records where size is at least 1000 bytes.</li> <li><code>size__lteq=1000</code> returns records where size is less than or equal to 1000 bytes.</li> <li><code>size__gteq=1000&amp;size__lteq=2000</code> returns records where size is between 1000 and 2000 bytes.</li> <li><code>size=1000</code> return records where size is exactly 1000 bytes.</li> </ul>"},{"location":"registry/api_changes/#new-endpoints","title":"New Endpoints","text":"<p>API endpoints for the following types are new. Please follow the links for details.</p> <ul> <li>Alerts</li> <li>Checksums</li> <li>Deletion Requests</li> </ul>"},{"location":"registry/api_changes/#generic-files","title":"Generic Files","text":""},{"location":"registry/api_changes/#changed","title":"Changed","text":"<p>The following endpoints have changed as noted.</p> <ul> <li><code>/member-api/v2/files/{institution_identifier}</code> -&gt; <code>/member-api/v3/files</code></li> <li><code>/member-api/v2/files/{intellectual_object_identifier}</code> -&gt; <code>/member-api/v3/files?intellectual_object_id={object_id}</code></li> </ul>"},{"location":"registry/api_changes/#deleted","title":"Deleted","text":"<p>The following endpoint is no longer implemented:</p> <ul> <li><code>/member-api/v2/files/restore/{generic_file_id}</code></li> </ul>"},{"location":"registry/api_changes/#added","title":"Added","text":"<p>Registry adds the following Generic File endpoint:</p> <p><code>/member-api/v3/files/show/{id}</code></p> <p>This returns a Generic File object with nested Premis Events, Checksums and Storage Records.</p>"},{"location":"registry/api_changes/#json-changes","title":"JSON Changes","text":"<p>The GenericFileView object returned by calls to <code>/member-api/v3/files</code> is a superset of the File object returned by the Pharos API. In addition to the old Pharos fields, GenericFileView contains the following:</p> <ul> <li><code>size</code> (integer) - The size of the file, in bytes.</li> <li><code>object_identifier</code> (string) - The identifier of the Intellectual Object to which this file belongs.</li> <li><code>access</code> (string) - The file's access setting.</li> <li><code>institution_id</code> (integer) - The ID of the institution that owns this file.</li> <li><code>institution_name</code> (string) - The name of the institution that owns this file.</li> <li><code>institution_identifier</code> (string) - The identifier (domain name) of the institution that owns this file.</li> <li><code>storage_option</code> (string) - Describes where this file is stored.</li> <li><code>uuid</code> (string) - The object's preservation identifier.</li> <li><code>md5</code> (string) - The most recently calculated md5 checksum for this file.</li> <li><code>sha1</code> (string) - The most recently calculated sha1 checksum for this file.</li> <li><code>sha256</code> (string) - The most recently calculated sha256 checksum for this file.</li> <li><code>sha512</code> (string) - The most recently calculated sha512 checksum for this file.</li> <li><code>storage_records</code> (Array{Storage Record}) - A list of storage records indicating where this file is saved in preservation storage.</li> </ul>"},{"location":"registry/api_changes/#intellectual-objects","title":"Intellectual Objects","text":""},{"location":"registry/api_changes/#changed_1","title":"Changed","text":"<p>The following endpoints have changed as noted.</p> <ul> <li><code>/member-api/v2/objects</code> -&gt; <code>/member-api/v3/objects</code></li> <li><code>/member-api/v2/objects/{institution_identifier}</code> -&gt; <code>/member-api/v3/objects</code></li> </ul> <p>Note that the member API allows you to retrieve information about object belonging to your own institution only.</p>"},{"location":"registry/api_changes/#deleted_1","title":"Deleted","text":"<p>The following endpoint is no longer implemented:</p> <ul> <li><code>/member-api/v2/objects/restore/{intellectual_object_id}</code></li> </ul>"},{"location":"registry/api_changes/#added_1","title":"Added","text":"<p>Registry adds the following Intellectual Object endpoint:</p> <p><code>/member-api/v3/objects/show/{id}</code></p> <p>This returns an Intellectual Object summary. The summary does not include files or events because many objects have thousands of files and tens or hundreds of thousands of events. Use the file and event endpoints to retrieve paged lists of files and events.</p>"},{"location":"registry/api_changes/#json-changes_1","title":"JSON Changes","text":"<p>The Intellectual Object view records returned by the Registry API are a superset of the old Pharos object records. In addition to the fields returned by Pharos, Registry adds the following:</p> <ul> <li><code>bag_group_identifier</code> (string) - Identifies the group of bags to which this bag belongs. This is often empty</li> <li><code>storage_option</code> (string) - Describes where this object's files are stored.</li> <li><code>bagit_profile_identifier</code> (string) - Describes the BagIt profile used to create and restore this object. This will be either and APTrust or BTR profile identifier.</li> <li><code>source_organization</code> (string) - The value of the Source-Organization tag in the object's bag-info.txt file.</li> <li><code>internal_sender_identifier</code> (string) - The value of the Internal-Sender-Identifier tag in the object's bag-info.txt file.</li> <li><code>internal_sender_description</code> (string) - The value of the Internal-Sender-Description tag in the object's bag-info.txt file.</li> <li><code>institution_name</code> (string) - The name of the institution that deposited this object.</li> <li><code>institution_identifier</code> (string) - The identifier (domain name) of the institution that deposited this object.</li> <li><code>institution_type</code> (string) - Indicates whether the institution that owns this object is a member institution (account) or subscribing institution (sub-account).</li> <li><code>institution_parent_id</code> (integer) - ID of this institution's parent. Applicable to subscriber institutions (sub-accounts) only.</li> <li><code>file_count</code> (integer) - The total number of files preserved for this object. This includes payload files and preserved manifests. APTrust does not preserve manifests or tag manifests. This number can change over time as additional new files are ingested or existing ones are deleted.</li> <li><code>size</code> (integer) - The total number of bytes for all files preserved for this object. This number can change over time as additional new files are ingested or existing ones are deleted.</li> <li><code>payload_file_count</code> (integer) - The total number of files in this object's payload. I.e., inside the data directory of the bag that was uploaded for deposit. This number can change over time as additional new files are ingested or existing ones are deleted.</li> <li><code>payload_size</code> (integer) - Total size, in bytes, of the files in this object's payload directory (the data directory of the bag that was uploaded for ingest). This number can change over time as additional new files are ingested or existing ones are deleted.</li> </ul>"},{"location":"registry/api_changes/#premis-events","title":"Premis Events","text":""},{"location":"registry/api_changes/#changed_2","title":"Changed","text":"<p>The following endpoints have changed as noted.</p> <ul> <li><code>/member-api/v2/events/{generic_file_identifier}</code> -&gt; <code>/member-api/v3/events?generic_file_identifier={identifier}</code> or <code>/member-api/v3/events?generic_file_id={id}</code></li> <li><code>/member-api/v2/events/{intellectual_object_identifier}</code> -&gt; <code>/member-api/v3/events?intellectual_object_identifier={identifier}</code> or <code>/member-api/v3/events?intellectual_object_id={id}</code></li> </ul>"},{"location":"registry/api_changes/#deleted_2","title":"Deleted","text":"<p>The following endpoint was deleted because member institutions can retrieve only their own events.</p> <ul> <li><code>/member-api/v2/events/{institution_identifier}</code></li> </ul>"},{"location":"registry/api_changes/#added_2","title":"Added","text":"<p>The new endpoint <code>/member-api/v3/events/show/{id}</code> displays details of a single event.</p>"},{"location":"registry/api_changes/#json-changes_2","title":"JSON Changes","text":"<p>The version 3 JSON contains all of the fields from the version 2 API, plus the following:</p> <ul> <li><code>institution_name</code> (string) - The name of the institution to which the event pertains.</li> </ul>"},{"location":"registry/api_changes/#work-items","title":"Work Items","text":""},{"location":"registry/api_changes/#changed_3","title":"Changed","text":"<p>The following endpoints have changed as noted.</p> <ul> <li><code>/member-api/v2/items</code> - <code>/member-api/v3/items</code></li> </ul>"},{"location":"registry/api_changes/#deleted_3","title":"Deleted","text":"<p>No Work Item endpoints were deleted.</p>"},{"location":"registry/api_changes/#added_3","title":"Added","text":"<p>The following endpoint was added:</p> <ul> <li><code>/member-api/v3/items/show/{id}</code></li> </ul>"},{"location":"registry/api_changes/#json-changes_3","title":"JSON Changes","text":"<ul> <li><code>alt_identifier</code> (string) - An alternate identifier for this object to which this Work Item pertains, supplied by the depositor.</li> <li><code>bag_group_identifier</code> (string) - An optional identifier naming the logical group to which this object belongs. For instance, if ten bags are all part of the same collection, the collection name may be used as the group identifier associating all ten bags.</li> <li><code>bagit_profile_identifier</code> (string) - The identifier of the BagIt profile used to create this bag. This can be either the APTrust profile URL or the BTR profile URL. Bags will be restored using the same profile under which they were submitted.</li> <li><code>date_processed</code> (datetime as string) - The date and time of last known activity on this work item. This timestamp may change several times during multipart processes such as ingest.</li> <li><code>institution_identifier</code> (string) - The identifier (domain name) of the institution that owns the files or objects to which this deletion request pertains.</li> <li><code>institution_name</code> (string) - The name of the institution that owns the files or objects to which this work item pertains.</li> <li><code>internal_sender_identifier</code> (string) - An optional identifier for internal use by the depositor. The identifier belongs to the object to which this work item pertains.</li> <li><code>node</code> (string) - The hostname of the microservice worker currently processing this item. If this is empty, the item is not currently being processed.</li> <li><code>pid</code> (integer) - The process ID of the worker that is currently working on this item. If this is empty, the item is not currently being processed.</li> <li><code>source_organization</code> (string) - The name of the institution that submitted the object for ingest. This comes from the Source-Organization tag in the original bag.</li> <li><code>storage_option</code> (string) - Indicates where the object's files are stored.</li> </ul>"},{"location":"registry/events/","title":"Premis Events","text":"<p>APTrust records PREMIS events for intellectual objects and generic files. You can view a list of all events related to your instution's objects and files by clicking the Events link under  More Options tab in the left nav.</p> <p></p> <p>Use the filters at the top of the page to filter by event type, date, outcome, file identifier and object identifier.</p> <p>Note</p> <p>Note that although the sidebar lists all of the event types defined by the Library of Congress's PREMIS specification, APTrust only implements the event types listed below.</p>"},{"location":"registry/events/#object-level-events","title":"Object-Level Events","text":"<p>The APTrust repository records the following PREMIS events for intellectual objects:</p> <ul> <li> <p>Ingestion - The ingest process for the object completed. This means the object record was created and all of the object's files were copied to preservation storage.</p> </li> <li> <p>Creation - The object record was created.</p> </li> <li> <p>Access Assignment - The object was assigned an access setting of Consortia, Institution, or Restricted. See access values for definitions.</p> </li> <li> <p>Identifier Assignment - The object was assigned an identifier. APTrust object identifiers use the pattern <code>&lt;institution.domain&gt;/&lt;object_name&gt;</code>, where object_name is the name of the tarred bag, minus the .tar extension. For example, <code>test.edu/bag_of_photos</code>.</p> </li> <li> <p>Deletion - The object was deleted. This means that all of its component files were deleted. Registry keeps a record of the object and all of its files after deletion, though it does not retain the files themselves.</p> </li> </ul>"},{"location":"registry/events/#file-level-events","title":"File-Level Events","text":"<p>APTrust records the following PREMIS events for the generic files that make up each intellectual object:</p> <ul> <li> <p>Ingestion - The file has been copied to long-term preservation storage and its metadata has been saved in Registry.</p> </li> <li> <p>Identifier Assignment - The file has been assigned an APTrust identifier, in the form <code>&lt;object_identifier&gt;/&lt;file_relative_path&gt;</code>, where file_relative_path is the location of the file in the bag in which it was submitted. For example, if test.edu submits a bag called bag_of_photos, the payload file data/photo1.jpg would have the identifier <code>test.edu/bag_of_photos/data/photo1.jpg</code>.</p> </li> <li> <p>Message Digest Calculation - The APTrust ingest process has calculated a message digest for the file. On ingest, there should be two of these events for each file, one with an md5 digest and one with a sha256 digest.</p> </li> <li> <p>Replication - The file has been copied to replication storage. This applies only to files using the Stadard storage option, in which the primary copy exists in S3 in Northern Virginia and the secondard (replicated) copy is in Glacier in Oregon. See storage options for more information.</p> </li> <li> <p>Fixity Check - This records the outcome of a fixity check on this file. APTrust perform fixity checks on items in Standard storage every 90 days, but does not perform fixity checks on items in Glacier-Only or Glacier Deep Archive storage. See storage options for more information. Also note that APTrust checks the sha256 fixity only, even though we also know the md5 fixity value.</p> </li> <li> <p>Deletion - Records when a file was deleted and at whose request.</p> </li> </ul>"},{"location":"registry/files/","title":"Generic Files","text":"<p>Generic files are the individual files or bitstreams that make up intellectual objects. These may be photos, videos, text documents, XML metadata files exported from your internal repository, etc.</p> <p>When you send a bag to your receiving bucket, APTrust creates an intellectual object from the bag (or updates an existing object, if the bag name matches the name of an existing object), and APTrust stores all of the bag's payload files and tag files. Any file outside the bag's data directory, except for manifests and tag manifests, is considered a tag file.</p>"},{"location":"registry/files/#listing-files","title":"Listing Files","text":"<p>You view a list of your institution's generic files by clicking on the Files link under More Options in the Registry's left nav bar.</p> <p></p> <p>Use the filters at the top of the page to narrow down the list. Standard filters include File Identifier, State, and Storage Option. Click the More Filters link to filter by file size, creation date and modification date.</p>"},{"location":"registry/files/#file-details","title":"File Details","text":"<p>Click on the identifier of any file to view its detail page. From the detail page, you'll see checksums and events related to the file. Scroll down to see the file Restore button. Institutional admins will also see a Delete button at the bottom of the file detail page.</p> <p></p>"},{"location":"registry/objects/","title":"Intellectual Objects","text":"<p>An intellectual object is a logical collection of files. Registry creates one intellectual object for each tarred bag file you upload to your receiving bucket. Collections spanning multiple bags can be logically linked using the Bag-Group-Identifier in the bag-info.txt file.</p>"},{"location":"registry/objects/#listing-objects","title":"Listing Objects","text":"<p>To view a list of your institution's intellectual objects, click the Objects link in the left navigation bar.</p> <p></p> <p>To find objects by identifier, bag name, title, bag group identifier, or alternate identifier, click the More Filters link. You'll find you can also filter by bag size, file count, and the dates on which objects were created or updated.</p>"},{"location":"registry/objects/#alternate-identifiers","title":"Alternate Identifiers","text":"<p>Alternate identifiers come from the Internal-Sender-Identifier tag in the bag-info.txt file. This usually identifies an object using your internal identifier scheme. This field is optional and may be blank.</p>"},{"location":"registry/objects/#bag-group-identifiers","title":"Bag Group Identifiers","text":"<p>The optional bag group identifier comes from the Bag-Group-Identifier field in the bag-info.txt file. This is used to logically group a number of distinct intellectual objects. For example, some organizations prefer to break large collections into a series of smaller bags, each of which becomes a distinct intellectual object upon ingest.</p> <p>A group of objects called <code>test.edu/smith_photos_1946</code>, <code>test.edu/smith_photos_1947</code>, and <code>test.edu/smith_photos_1948</code> may be logically grouped with the Bag-Group-Identifier <code>Smith Photos</code>. You can then search Registry for objects belonging to this group to find all files belonging to the <code>Smith Photos</code> collection.</p>"},{"location":"registry/objects/#viewing-object-details","title":"Viewing Object Details","text":"<p>Click any object title in the list of objects to view its details. The top of the object detail page displays essential metadata such as the object's title, description, and identifiers.</p> <p>To the right is a list of recent PREMIS events and a button to restore the object. Institutional administrators will also see a button delete the object.</p> <p></p> <p>Scroll down the object detail page and you'll find file summary charts and a list of files that make up the object.</p> <p></p> <p>Click the plus sign next to any file in the list to see more information about that file. Info includes checksums, storage URLs and a button to restore the file. Institutional admins will also see a button to delete the file.</p> <p></p>"},{"location":"registry/reports/","title":"Reports","text":"<p>The Registry includes two reports to show deposit statistics, Deposits by Institution and Deposits Over Time.</p>"},{"location":"registry/reports/#deposits-by-institution","title":"Deposits by Institution","text":"<p>Deposits by Institution shows the deposits for an instition up until today, or up until the date selected in the Deposits Through list. Most institutions can see only their own deposit numbers. Member Institutions will also be able to see deposit statistics for their Associate Members.</p> <p></p> <p>You can change the metric displayed in the graph by changing the Chart Metric option to show deposits by Gigabyte or Terabyte, or to show the number of objects of files on deposit.</p> <p>The raw numbers in the report appear in the table below the chart. Mouse over any bar on the chart to see a description of what the bar represents</p>"},{"location":"registry/reports/#deposits-over-time","title":"Deposits Over Time","text":"<p>Change the Report Type selection to Deposits Over Time and you'll see a line chart showing how the quantity of your institution's deposits have changed over time. As with Deposits by Institution, you can change which metrics appear on the chart.</p> <p>This report does not currently show raw data below the chart because in many cases there are too many data points to display.</p> <p>Note that you can show and hide lines on this chart by clicking the legend above the chart.</p> <p></p>"},{"location":"registry/rest_api/","title":"Registry REST API","text":"<p>The Registry REST API enables you to programmatically query information about intellectual objects, files, premis events, and work items.</p> <p>For safety purposes, the API is primarily read-only. It does not allow object or file deletion, though it does allow you to request object restoration.</p> <p>The most common uses of the API are:</p> <ul> <li>Querying for an inventory of intellectual objects</li> <li>Querying for an inventory of files</li> <li>Checking the status of pending work items, such as ingests and restorations</li> </ul> <p>Perl API Clients</p> <p>The APTrust Registry is protected against distributed denial of service (DDOS) attacks by CloudFlare. CloudFlare may refuse access to Perl LWP clients. To get around this, you can set the User-Agent name of your LWP client like so: <code>$ua-&gt;agent('Mozilla/5.0');</code> Another alternative is to use the WWW::Mechanize package as described in this StackOverflow thread.</p>"},{"location":"registry/rest_api/#getting-an-api-key","title":"Getting an API Key","text":"<p>To use the API, you'll need to get an API token from Registry. Follow these steps:</p> <ol> <li> <p>Log in to Registry.</p> </li> <li> <p>Click the user icon in the upper right corner to see your My Account page.</p> </li> <li> <p>Click the Get API Key button.</p> </li> </ol> <p></p> <p>Separate Keys for Demo and Production Repositories</p> <p>The key you generate on https://demo.aptrust.org will only work on the demo server. The key you generate on https://repo.aptrust.org will only work on the production server.</p>"},{"location":"registry/rest_api/#using-your-key-to-connect-to-the-rest-api","title":"Using Your Key to Connect to the REST API","text":"<p>To connect to the REST API, send your Registry login email address and your API key in the following request headers:</p> <pre><code>X-Pharos-API-User: user@example.com\nX-Pharos-API-Key: topsecretapikey\n</code></pre>"},{"location":"registry/rest_api/#rest-api-documentation","title":"REST API Documentation","text":"<p>You'll find interactive documentation for the Registry REST API at https://aptrust.github.io/registry/. If you're curious, you can compare this to the old Pharos API.</p> <p>The Registry API includes a number of new and updated endpoints. See the API Changes page for details.</p>"},{"location":"registry/rest_api/#generating-a-registry-rest-client","title":"Generating a Registry REST Client","text":"<p>You can generate a Registry API client for most commonly used languages by following these steps:</p> <ol> <li>Go to the online Swagger editor.</li> <li>Select File &gt; Import URL from the top menu.</li> <li>Enter the URL https://raw.githubusercontent.com/APTrust/registry/master/member_api_v3.yml and click OK.</li> <li>Click Generate Client from top menu.</li> <li>Choose the programming language you want to use.</li> </ol> <p>The Swagger editor will generate a client that you can use in your local scripts and workflows. Languages include Java, C#, Go, Python, PHP, Ruby, and more.</p> <p>Because the Registry's API documentation follows the OpenAPI version 3.0 standard, you can use the OpenAPI generator of your choice. The OpenAPI tools website maintains a list of SDK generators. In addition, the OpenAPI Generator project provides generators for more than fifty languages.</p>"},{"location":"registry/rest_api/#documentation-links","title":"Documentation Links","text":"<ul> <li>Interactive Swagger Docs</li> <li>Human-Readable OpenAPI Source</li> <li>Machine-Readable OpenAPI Source</li> </ul>"},{"location":"registry/spot_tests/","title":"Configuring Restoration Spot Tests","text":"<p>Restoration spot tests periodically restore a single, random intellectual object to your institution's restoration bucket. When the spot test completes, APTrust sends an email to your institution's users and admins telling them a restored item is available for download.</p> <p>These spot tests aim to ensure:</p> <ol> <li>That APTrust can successfully restore an object to your receiving bucket.</li> <li>That your institution can make sense of the object, and can import it back into your institutional repository or DAMS, if necessary.</li> </ol> <p>To configure spot tests for your institution:</p> <ol> <li> <p>Click More Options in the left navigation bar.</p> </li> <li> <p>Click Institution.</p> </li> <li> <p>Click Edit.</p> </li> <li> <p>Set Restoration spot test frequency to the number of days you'd like between tests. Common options are 30, 60, or 90 days. You can disable spot tests by setting days to zero.</p> </li> <li> <p>Click Submit.</p> </li> </ol> <p></p>"},{"location":"registry/two_factor_auth/","title":"Two-Factor Authentication","text":"<p>Registry supports two-factor authentication for users and institutions who want an extra layer of security. Two Factor Authentication is required for institutional administrators in both the production repository and the demo repository, since institutional admins have the ability to delete materials. It is not required for institutional users, however we recommend that all users enable it.</p> <p>Tip</p> <p>Two-factor settings are separate on the production and demo repositories. Enabling or disabling this feature in the Registry production system has no effect on the demo system and vice-versa. You'll have to set your preferences separately on each system.</p>"},{"location":"registry/two_factor_auth/#enabling-two-factor-authentication","title":"Enabling Two-Factor Authentication","text":"<p>Institutional users can enable two-factor authentication for themselves. Institutional administrators can require it for all users at their institution, thereby forcing them to enable it. Institutional users who enable two-factor auth for themselves can choose to disable it later. When an administrator enables two-factor auth for their institution, users cannot opt out or disable the setting.</p>"},{"location":"registry/two_factor_auth/#enabling-two-factor-for-yourself","title":"Enabling Two-Factor for Yourself","text":"<p>To enable two-factor authentication for yourself, click the My Account in the upper right corner of the screen.</p> <p></p> <p>Click the Set Up Two-Factor Auth button. Then enter your mobile phone number and choose either Authy or Text Message.</p> <p>Authy allows you to complete two-factor authentication via push notification, while Text sends a text (SMS) message to your phone with a one-time authentication token.</p> <p></p> <p>Click Submit when you're done.</p> <p>You should receive a text message or push notification within a minute or so. If you chose the text/SMS option, enter the code you received in the text message into the verification field in Registry.</p> <p>If you have Authy installed on your phone and you chose to verify via push notification, click the Approve button when the Authy verification request appears.</p> <p></p>"},{"location":"registry/two_factor_auth/#generating-backup-codes","title":"Generating Backup Codes","text":"<p>If you're using two-factor authentication, you should generate a set of backup codes, in case you need to log in to the Registry when you don't have access to your phone.</p> <p>To generate backup codes, click the Generate Backup Codes button at the top of the My Account page. Copy your backup codes to a safe place on your computer. These codes are valid for one-time use.</p>"},{"location":"registry/two_factor_auth/#enabling-two-factor-for-other-users-or-your-entire-institution","title":"Enabling Two-Factor for Other Users or Your Entire Institution","text":"<p>Institutional administrators can require two-factor authentication for specific users at their institution, or for the institution as a whole.</p> <p>To enable two-factor auth for a specific user:</p> <ol> <li> <p>Click Users on the left nav bar.</p> </li> <li> <p>Click the name of the user you want to edit.</p> </li> <li> <p>Change Require Two-Factor Auth to Yes.</p> </li> <li> <p>Click Submit.</p> </li> </ol> <p>To require two-factor auth for your institution:</p> <ol> <li> <p>Click More Options in the left navigation bar.</p> </li> <li> <p>Click Institution.</p> </li> <li> <p>Click Edit.</p> </li> <li> <p>Change Enable two-factor authentication? to Yes.</p> </li> <li> <p>Click Submit.</p> </li> </ol> <p></p>"},{"location":"registry/two_factor_auth/#grace-period-for-new-users","title":"Grace Period for New Users","text":"<p>New users have a grace period during which they will be prompted to enabled two-factor authentication. On the production repository, this grace period is 30 days long. On the demo repository, this grace period is 90 days long. The grace period begins when the user's account is created. It applies to all users for whom two-factor auth is required (institutional administrators and institutional users for whom two-factor auth has been required at their institution).</p>"},{"location":"registry/two_factor_auth/#if-youre-locked-out","title":"If You're Locked Out","text":"<p>If you can't log in and you don't have access to any valid backup codes, contact help@aptrust.org.</p>"},{"location":"registry/user_management/","title":"User Management","text":""},{"location":"registry/user_management/#listing-users","title":"Listing Users","text":"<p>You can see a list of users at your institution by clicking the Users link in the left nav bar.</p> <p></p>"},{"location":"registry/user_management/#viewing-and-editing-users","title":"Viewing and Editing Users","text":"<p>Click any user in the Users list to view their details.</p> <p></p> <p>The buttons at the top of the screen do the following:</p> <ul> <li>Edit - Edit user details. For details on what the settings mean, see Adding New Users below.</li> <li>Deactivate - Deactivates a user's account. Once deactivated, the user will not be able to log in. This action is reversible. You can re-activate any user at any time.</li> <li>Change Password - This lets you specify a new password for a user.</li> <li>Force Password Reset - This sends an email to the user with a special link that will let them choose their own new password.</li> </ul>"},{"location":"registry/user_management/#adding-new-users","title":"Adding New Users","text":"<p>Institutional administrators can add new users at their institition. To add a new user:</p> <ol> <li> <p>Click Users in the left nav bar.</p> </li> <li> <p>Click the green Add New User button in the top right corner of the screen.</p> </li> <li> <p>Enter the new user's name, email address and mobile phone number.</p> <ol> <li> <p>This person will use the specified email address to log in.</p> </li> <li> <p>The phone number will be used for two-factor authentication, if the user has it enabled.</p> </li> <li> <p>If you want the user to use two-factor authentication, specify a date by which they must activate two-factor authentication. The user will need to log into the system before that date--without two-factor--to set up their multi-step authentication.</p> </li> </ol> </li> <li> <p>Select one of the following roles:</p> <ol> <li> <p>Institutional Admin - This role has all the privilages of the institutional user, and can add, edit, and deactivate users at your organization. It can also access restricted objects and initiate and approve object and file deletions.</p> </li> <li> <p>Institutional User - This role can send materials to APTrust for ingest, and can view and restore files and objects that are not restricted.</p> </li> </ol> </li> </ol> <p></p>"},{"location":"registry/user_management/#reactivating-deactivated-users","title":"Reactivating Deactivated Users","text":"<ol> <li>Click the Users link in the left nav bar.</li> <li> <p>Click on the name of the users you want to reactivate. Deactivated users have a non-empty Disabled date describing when their account was disabled. In the screenshot below, the first user in the list was deactivated on January 15, 2021.</p> <p></p> </li> <li> <p>On the user's detail page, click the Reactivate button.</p> <p></p> </li> </ol>"},{"location":"registry/work_items/","title":"Work Items","text":"<p>Work items are tasks that APTrust systems perform in response to depositor requests. The Work Items list shows the status of your institution's recent requests. You can view the list by clicking the Work Items link in the left navigation bar.</p> <p></p> <p>You can filter the list to specific actions, statuses, and stages using the controls at the top of the list. To select multiple actions, statuses or stages, hold the Control key while clicking on items in the select list.</p> <p>Click More Filters to see a list of additional filters to help you narrow your search.</p>"},{"location":"registry/work_items/#actions","title":"Actions","text":"<p>Work Item actions include the following:</p> <ul> <li> <p>Delete - Deleting files or objects from preservation storage.</p> </li> <li> <p>Glacier Restore - This is the first step in restoring objects and files from Glacier.</p> </li> <li> <p>Ingest - Getting new or updated objects into the system.</p> </li> <li> <p>Restore File - Restoring an individual file to a depositor's restoration bucket.</p> </li> <li> <p>Restore Object - Restoring an intellectual object to a depositor's restoration bucket.</p> </li> </ul>"},{"location":"registry/work_items/#stages","title":"Stages","text":"<ul> <li> <p>Available in S3 - A restored file or object is available in the depositor's S3 restoration bucket.</p> </li> <li> <p>Cleanup - The task has completed and the system has cleaned up temporary files. This applies only to ingest and restoration actions. This stage is more meaningful to APTrust internal operations than to depositors.</p> </li> <li> <p>Copy to Staging - Files are being copied to a staging bucket as part of the ingest process.</p> </li> <li> <p>Format Identification - Files being ingested are undergoing format identification against a PRONOM database.</p> </li> <li> <p>Fetch - The system is retrieving a bag from the receiving bucket for ingest, or is retrieving files from preservation storage for restortation.</p> </li> <li> <p>Package - An intellectual object's files are being repackaged into a new bag for restoration.</p> </li> <li> <p>Receive - APTrust has noticed a new bag in a receiving bucket, but has not yet begun to process it for ingest.</p> </li> <li> <p>Record - The system has finished copying a bag's files to preservation storage and is now recording metadata in Registry.</p> </li> <li> <p>Reingest Check - Files being ingested are checked against known files in the Registry to see if they've been ingested before. The system will re-ingest files only if they've changed since the last ingest.</p> </li> <li> <p>Requested - A depositor has requested a restoration or deletion, but the system has not yet begun to process it.</p> </li> <li> <p>Resolve - A task has completed. See Statuses below for the outcome.</p> </li> <li> <p>Restoring - Files are in process of being restored to a depositor's restoration bucket.</p> </li> <li> <p>Storage Validation - The ingest process is verifying that files copied into preservation storage were copied successfully.</p> </li> <li> <p>Store - Files are being copied to long-term preservation. This applies only to ingest.</p> </li> <li> <p>Unpack - Obsolete. This stage remains because it was used in some early ingests between 2015 and 2016.</p> </li> <li> <p>Validate - The system is validating a bag before ingest, or it's validating a bag it has just assembled for restoration.</p> </li> </ul>"},{"location":"registry/work_items/#statuses","title":"Statuses","text":"<ul> <li> <p>Cancelled - The task was cancelled by an APTrust administrator. You find an explanation of the cancellation by clicking on the item and reading the Note/Error field.</p> </li> <li> <p>Failed - The task failed. Virtually all failures result from one of the following causes:</p> <ul> <li> <p>A depositor submitted an invalid bag for ingest. This is a permanent error and the system will not retry the task until the depositor submits a new version of the bag.</p> </li> <li> <p>The system has run into a temporary problem such as lack of disk space or poor network connection. The system will automatically retry the task. If the task fails repeatedly, an APTrust admin will try to solve the underlying problem and then tell the system to retry the task again.</p> </li> </ul> </li> <li> <p>Pending - The system is waiting for available resources to start the next stage of the task. See Stages above.</p> </li> <li> <p>Started - The system has started the current Stage of the task and is still working on it. The Fetch, Validate, Store, Record, and Package stages can take several hours for very large bags.</p> </li> <li> <p>Success - The task completed successfully.</p> </li> <li> <p>Suspended - The task was suspended due to a potential conflict. These items are flagged for administrator review, and an APTrust administrator will determine whether to resume or cancel the item.</p> </li> </ul>"}]}